import{r as d,j as e}from"./vendor-Ctk_PxZ3.js";import{f as V,a as R,t as I,b as W,c as L}from"./index-DLvJvFgM.js";import{P}from"./PriorityBadge-CTzKxQaM.js";import{B as Y,T as z,b as J,t as T,m as K,C as G,P as Q,A as X,W as Z,u as ee,k as te,v as re,w as se,H as oe,x as ae}from"./icons-uZbbkKSh.js";import"./radix-BrLWYKju.js";import"./tanstack-Blm1ijQD.js";import"./supabase-iUa_TVcT.js";import"./router-CoGOqbGX.js";const le=[{key:"overdue",title:"Overdue",pillClass:"bg-danger/15 text-danger border border-danger/30",cardLeftBorderClass:"border-l-4 border-l-danger/70"},{key:"due_today",title:"Due Today",pillClass:"bg-primary/15 text-primary border border-primary/30",cardLeftBorderClass:"border-l-4 border-l-primary/70"},{key:"upcoming",title:"Upcoming",pillClass:"bg-muted text-foreground border border-border",cardLeftBorderClass:"border-l-4 border-l-border"},{key:"no_due_date",title:"No Due Date",pillClass:"bg-muted/60 text-muted-foreground border border-border",cardLeftBorderClass:"border-l-4 border-l-muted"}];function D(o){const a=o.getFullYear(),x=String(o.getMonth()+1).padStart(2,"0"),c=String(o.getDate()).padStart(2,"0");return`${a}-${x}-${c}`}function ne(o){if(!o)return"no_due_date";const a=new Date(o);if(Number.isNaN(a.getTime()))return"no_due_date";const c=D(new Date),l=D(a);return l<c?"overdue":l===c?"due_today":"upcoming"}function A(o){if(!o)return 2;const a=String(o).toLowerCase();return a==="high"?0:a==="medium"?1:2}function de(o){return o===!0}const he=({onNavigate:o,onQuickAdd:a})=>{const[x,c]=d.useState([]),[l,B]=d.useState([]),[i,ie]=d.useState(null),[m,$]=d.useState(null),[E,j]=d.useState(!0);d.useEffect(()=>{O()},[]);const O=async()=>{j(!0);try{const[t,s,r]=await Promise.all([V(),R({date:I()}),W()]);c(t),B(s),$(r)}catch(t){console.error(t)}j(!1)},b=d.useMemo(()=>m?[...m.activities,...m.materials,...m.equipment,...m.crew].map(s=>{var y,N,v,_,C,k,w,S;const r=s.due_date??s.required_date??null,n=s.bucket||ne(r),u=((N=(y=s.daily_logs)==null?void 0:y.projects)==null?void 0:N.name)||((v=s.project)==null?void 0:v.name)||((_=s.projects)==null?void 0:_.name)||s._project||"Unknown",p=((k=(C=s.daily_logs)==null?void 0:C.projects)==null?void 0:k.job_number)||((w=s.project)==null?void 0:w.job_number)||((S=s.projects)==null?void 0:S.job_number)||s._jobNumber||"",f=s.title||s.description||s.equipment_name||s.worker_name||"Unnamed",h=s.details||s.notes||s.note||"",F=de(s.pinned),H=s.priority||s._priority||"medium";return{...s,_bucket:n,_due:r,_project:u,_jobNumber:p,_title:f,_details:h,_pinned:F,_priority:H}}):[],[m]),q=d.useMemo(()=>{const t={overdue:[],due_today:[],upcoming:[],no_due_date:[]};for(const r of b)t[r._bucket].push(r);const s=(r,n)=>{if(r._pinned!==n._pinned)return r._pinned?-1:1;const u=A(r._priority),p=A(n._priority);if(u!==p)return u-p;const f=r._due?new Date(r._due).getTime():Number.POSITIVE_INFINITY,h=n._due?new Date(n._due).getTime():Number.POSITIVE_INFINITY;return f-h};return Object.keys(t).forEach(r=>{t[r]=t[r].sort(s)}),t},[b]),M=i?[{label:"Active Projects",value:i.activeProjects,icon:Y,color:"from-blue-500 to-blue-600",textColor:"text-blue-400"},{label:"High Priority",value:i.highPriorityLogs,icon:z,color:"from-red-500 to-red-600",textColor:"text-danger"},{label:"Overdue Items",value:i.totalOverdue,icon:J,color:"from-primary to-primary",textColor:"text-primary"},{label:"Pending Materials",value:i.pendingMaterials,icon:T,color:"from-purple-500 to-purple-600",textColor:"text-purple-400"},{label:"Safety Incidents",value:i.safetyIncidents,icon:K,color:"from-emerald-500 to-emerald-600",textColor:"text-emerald-400"},{label:"Total Logs",value:i.totalLogs,icon:G,color:"from-indigo-500 to-indigo-600",textColor:"text-indigo-400"}]:[],U=[{label:"Work Activity",icon:X,color:"bg-blue-500/20 text-blue-600 border-blue-500/30",action:()=>o("daily-logs",{tab:"activities"})},{label:"Materials",icon:T,color:"bg-purple-500/20 text-purple-600 border-purple-500/30",action:()=>o("daily-logs",{tab:"materials"})},{label:"Equipment",icon:Z,color:"bg-primary/20 text-primary border-primary/30",action:()=>o("daily-logs",{tab:"equipment"})},{label:"Crew",icon:ee,color:"bg-emerald-500/20 text-emerald-600 border-emerald-500/30",action:()=>o("daily-logs",{tab:"crew"})},{label:"Visitor",icon:te,color:"bg-indigo-500/20 text-indigo-600 border-indigo-500/30",action:()=>o("daily-logs",{tab:"visitors"})},{label:"Delivery",icon:re,color:"bg-rose-500/20 text-rose-600 border-rose-500/30",action:()=>o("calendar",{type:"delivery"})}];if(E)return e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-primary"})});const g=b.length;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Command Center"}),e.jsxs("p",{className:"text-muted-foreground text-sm mt-1",children:[L(I())," â€” ",l.length," job",l.length!==1?"s":""," logged today"]})]}),e.jsxs("button",{onClick:a,className:"flex items-center gap-2 px-4 py-2.5 rounded-lg bg-primary hover:bg-primary/90 text-primary-foreground font-semibold text-sm transition-colors",children:[e.jsx(Q,{className:"w-4 h-4"}),"New Job"]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3",children:M.map((t,s)=>{const r=t.icon;return e.jsxs("div",{className:"bg-card border border-border rounded-xl p-4 hover:border-border/50 transition-colors",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx("div",{className:`w-8 h-8 rounded-lg bg-gradient-to-br ${t.color} flex items-center justify-center`,children:e.jsx(r,{className:"w-4 h-4 text-foreground"})})}),e.jsx("div",{className:"text-2xl font-bold text-foreground",children:t.value}),e.jsx("div",{className:"text-xs text-muted-foreground mt-0.5",children:t.label})]},s)})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-semibold text-foreground uppercase tracking-wider mb-3",children:"Quick Add"}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-6 gap-2",children:U.map((t,s)=>{const r=t.icon;return e.jsxs("button",{onClick:t.action,className:`flex flex-col items-center gap-2 p-3 rounded-xl border ${t.color} hover:scale-105 transition-transform`,children:[e.jsx(r,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs font-medium",children:t.label})]},s)})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-sm font-semibold text-foreground uppercase tracking-wider",children:"Active Projects"}),e.jsxs("button",{onClick:()=>o("daily-logs"),className:"text-xs text-primary hover:text-primary/90 flex items-center gap-1",children:["View All ",e.jsx(se,{className:"w-3 h-3"})]})]}),e.jsx("div",{className:"space-y-2 max-h-[500px] overflow-y-auto pr-1",children:x.filter(t=>t.status==="active").length===0?e.jsxs("div",{className:"bg-card border border-border rounded-xl p-6 text-center",children:[e.jsx(oe,{className:"w-8 h-8 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No active projects"}),e.jsx("button",{onClick:a,className:"mt-2 text-xs text-primary hover:text-primary/90",children:"Create your first job"})]}):x.filter(t=>t.status==="active").map(t=>{const s=l.filter(r=>r.project_id===t.id);return e.jsx("button",{onClick:()=>o("daily-logs",{project_id:t.id}),className:"w-full text-left bg-card border border-border rounded-xl p-4 hover:border-primary/30 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"text-xs font-mono text-primary bg-primary/10 px-1.5 py-0.5 rounded",children:t.job_number||"#"})}),e.jsx("h3",{className:"text-sm font-semibold text-foreground mt-1 truncate",children:t.name}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:t.location||t.client||"No location"})]}),e.jsx("div",{className:"flex flex-col items-end gap-1 ml-2",children:s.length>0&&e.jsx("span",{className:"text-[10px] bg-emerald-500/10 text-emerald-400 px-1.5 py-0.5 rounded-full border border-emerald-500/20",children:"Logged today"})})]})},t.id)})})]}),e.jsxs("div",{className:"lg:col-span-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-sm font-semibold text-foreground uppercase tracking-wider",children:"Command Center"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[g," open item",g!==1?"s":""]})]}),g===0?e.jsxs("div",{className:"bg-card border border-border rounded-xl p-8 text-center",children:[e.jsx(ae,{className:"w-10 h-10 text-success mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-foreground font-medium",children:"All clear!"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"No outstanding items to show"})]}):e.jsx("div",{className:"space-y-4 max-h-[500px] overflow-y-auto pr-1",children:le.map(t=>{const s=q[t.key]||[];return s.length===0?null:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-[11px] font-semibold px-2 py-1 rounded-lg ${t.pillClass}`,children:t.title}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s.length})]})}),e.jsx("div",{className:"space-y-2",children:s.slice(0,50).map((r,n)=>e.jsx("button",{type:"button",onClick:()=>{},className:`w-full text-left bg-card border border-border rounded-xl p-3 hover:border-border/50 transition-colors ${t.cardLeftBorderClass}`,children:e.jsx("div",{className:"flex items-start gap-3",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[r._pinned&&e.jsx("span",{className:"text-[10px] bg-primary/10 text-primary px-1.5 py-0.5 rounded border border-primary/20",children:"Pinned"}),e.jsx("span",{className:"text-sm font-medium text-foreground truncate",children:r._title}),e.jsx(P,{priority:String(r._priority).toLowerCase(),size:"sm",showIcon:!1}),r.category&&e.jsx("span",{className:"text-[10px] text-muted-foreground bg-muted px-1.5 py-0.5 rounded",children:String(r.category)}),r.status&&e.jsx("span",{className:"text-[10px] text-muted-foreground bg-muted px-1.5 py-0.5 rounded",children:String(r.status)})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-1 text-xs text-muted-foreground",children:[e.jsx("span",{className:"truncate",children:r._project}),r._jobNumber&&e.jsxs("span",{className:"font-mono text-primary/60",children:["#",r._jobNumber]}),r._due&&e.jsxs("span",{children:["Due: ",L(r._due)]})]}),r._details&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1 truncate",children:r._details})]})})},`${r.id||"x"}-${t.key}-${n}`))})]},t.key)})})]})]}),l.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-semibold text-foreground uppercase tracking-wider mb-3",children:"Today's Jobs"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:l.map(t=>{var s,r;return e.jsxs("button",{onClick:()=>o("daily-logs",{logId:t.id}),className:"text-left bg-card border border-border rounded-xl p-4 hover:border-primary/30 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs font-mono text-primary bg-primary/10 px-1.5 py-0.5 rounded",children:((s=t.project)==null?void 0:s.job_number)||"#"}),e.jsx(P,{priority:t.priority,size:"sm"})]}),e.jsx("h3",{className:"text-sm font-semibold text-foreground",children:((r=t.project)==null?void 0:r.name)||"Unknown Project"}),e.jsxs("div",{className:"flex items-center gap-3 mt-2 text-xs text-muted-foreground",children:[t.weather&&e.jsx("span",{children:t.weather}),t.temperature&&e.jsx("span",{children:t.temperature})]}),t.critical_items&&e.jsx("div",{className:"mt-2 p-2 rounded-lg bg-danger/10 border border-danger/20",children:e.jsx("p",{className:"text-xs text-danger line-clamp-2",children:t.critical_items})})]},t.id)})})]})]})};export{he as default};
