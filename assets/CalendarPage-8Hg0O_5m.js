import{r as l,F as k,j as e,K as U,E as f,L as H,M as W}from"./vendor-PYixsk0d.js";import{t as X,h as Q,N as M,B as V,a as Z,f as ee,C as se,D as te,E as re}from"./index-CM72junN.js";import{P as S}from"./PriorityBadge-DRo3qM3W.js";import{P as ae,g as le,f as oe,v as de,D as ne,G as ie,I as ce,J as me,K as D,z as xe,a as ue,X as pe}from"./icons-DUP5S1G1.js";import"./radix-D8qNXTYQ.js";import"./tanstack-C9VkMA4e.js";import"./supabase-BGS_MQFj.js";import"./router-DIvsDq8X.js";const u="lld-input w-full px-3 py-2 rounded-lg text-sm",p="block text-xs font-medium text-muted-foreground mb-1",_e=({onNavigate:E,initialData:he})=>{const[o,g]=l.useState(new Date),[n,N]=l.useState(X()),[T,P]=l.useState([]),[F,I]=l.useState([]),[L,A]=l.useState([]),[$,i]=l.useState(!1),[ge,y]=l.useState(!0),[v,d]=l.useState(null),[t,c]=l.useState({title:"",description:"",note_type:"note",priority:"low",project_id:""}),h=async()=>{y(!0);try{const[s,a,r]=await Promise.all([V(o.getMonth(),o.getFullYear()),Z(),ee()]);P(s),I(a),A(r)}catch(s){console.error(s),d((s==null?void 0:s.message)||"Failed to add note")}y(!1)};l.useEffect(()=>{h()},[o]),l.useEffect(()=>{try{const s=k(n);(s.getFullYear()!==o.getFullYear()||s.getMonth()!==o.getMonth())&&g(s)}catch{}},[n]);const z=Q(o.getFullYear(),o.getMonth()),w=s=>{const a=F.filter(x=>x.log_date===s),r=T.filter(x=>x.note_date===s);return{logs:a,notes:r}},m=w(n),Y=async()=>{try{d(null),await re({...t,note_date:n,project_id:t.project_id||null,is_completed:!1}),c({title:"",description:"",note_type:"note",priority:"low",project_id:""}),i(!1),h()}catch(s){console.error(s),d((s==null?void 0:s.message)||"Failed to add note")}},R=async(s,a)=>{await se(s,{is_completed:a}),h()},B=async s=>{await te(s),h()},G={note:D,reminder:me,meeting:ce,deadline:ie,inspection:ne,delivery:de},J={note:"bg-blue-500",reminder:"bg-purple-500",meeting:"bg-indigo-500",deadline:"bg-red-500",inspection:"bg-primary",delivery:"bg-green-500"};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Calendar"}),e.jsxs("button",{onClick:()=>{d(null),i(!0)},className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-primary hover:bg-primary/90 text-primary-foreground text-sm font-semibold transition-colors",children:[e.jsx(ae,{className:"w-4 h-4"}),"Add Note"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 bg-card border border-border rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:()=>g(U(o)),className:"p-2 rounded-lg hover:bg-muted text-muted-foreground",children:e.jsx(le,{className:"w-5 h-5"})}),e.jsx("h2",{className:"text-lg font-bold text-foreground",children:f(o,"MMMM yyyy")}),e.jsx("button",{onClick:()=>g(H(o,1)),className:"p-2 rounded-lg hover:bg-muted text-muted-foreground",children:e.jsx(oe,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"grid grid-cols-7 gap-1 mb-1",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(s=>e.jsx("div",{className:"text-center text-xs font-medium text-muted-foreground py-2",children:s},s))}),z.map((s,a)=>e.jsx("div",{className:"grid grid-cols-7 gap-1",children:s.map((r,x)=>{if(!r)return e.jsx("div",{className:"aspect-square"},x);const b=f(r,"yyyy-MM-dd"),C=b===n,_=W(r,new Date),j=w(b),O=j.logs.length>0;return j.notes.length>0,e.jsxs("button",{onClick:()=>N(b),className:`aspect-square p-1 rounded-lg flex flex-col items-start transition-colors relative ${C?"bg-primary/20 border-2 border-primary/50":_?"bg-muted/70 border border-border":"hover:bg-muted/30 border border-transparent"}`,children:[e.jsx("span",{className:`text-xs font-medium ${C?"text-primary":"text-foreground"}`,children:r.getDate()}),e.jsxs("div",{className:"flex gap-0.5 mt-auto flex-wrap",children:[O&&e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-primary"}),j.notes.slice(0,3).map((q,K)=>e.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${J[q.note_type]||"bg-blue-500"}`},K))]})]},x)})},a)),e.jsxs("div",{className:"flex flex-wrap gap-3 mt-4 pt-3 border-t border-border",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-primary"})," Jobs"]}),M.map(s=>e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${s.color}`})," ",s.label]},s.value))]})]}),e.jsxs("div",{className:"bg-card border border-border rounded-xl p-4 overflow-y-auto max-h-[700px]",children:[e.jsx("h3",{className:"text-sm font-bold text-foreground mb-3",children:f(k(n),"EEEE, dd MMMM yyyy")}),m.logs.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-xs font-semibold text-foreground/80 uppercase mb-2",children:"Jobs"}),e.jsx("div",{className:"space-y-2",children:m.logs.map(s=>{var a,r;return e.jsxs("button",{onClick:()=>E("daily-logs",{logId:s.id}),className:"w-full text-left p-3 rounded-lg bg-primary/10 border border-amber-500/20 hover:border-amber-500/40 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs font-mono text-primary",children:["#",((a=s.project)==null?void 0:a.job_number)||"â€”"]}),e.jsx(S,{priority:s.priority,size:"sm",showIcon:!1})]}),e.jsx("p",{className:"text-sm font-medium text-foreground mt-1",children:((r=s.project)==null?void 0:r.name)||"Unknown"}),s.weather&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[s.weather," ",s.temperature]})]},s.id)})})]}),m.notes.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-xs font-semibold text-foreground/80 uppercase mb-2",children:"Notes & Reminders"}),e.jsx("div",{className:"space-y-2",children:m.notes.map(s=>{const a=G[s.note_type]||D;return e.jsx("div",{className:`p-3 rounded-lg border transition-colors ${s.is_completed?"bg-card/30 border-border opacity-60":"bg-muted/60 border-border"}`,children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("input",{type:"checkbox",checked:s.is_completed,onChange:r=>R(s.id,r.target.checked),className:"w-4 h-4 mt-0.5 rounded border-border bg-muted text-amber-500"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(a,{className:"w-3.5 h-3.5 text-muted-foreground"}),e.jsx("span",{className:`text-sm font-medium ${s.is_completed?"line-through text-muted-foreground":"text-foreground"}`,children:s.title})]}),s.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.description}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(S,{priority:s.priority,size:"sm",showIcon:!1}),e.jsx("span",{className:"text-[10px] text-muted-foreground capitalize",children:s.note_type})]})]}),e.jsx("button",{onClick:()=>B(s.id),className:"p-1 rounded hover:bg-red-500/20 text-red-400",children:e.jsx(xe,{className:"w-3.5 h-3.5"})})]})},s.id)})})]}),m.logs.length===0&&m.notes.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ue,{className:"w-8 h-8 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Nothing scheduled"}),e.jsx("button",{onClick:()=>{d(null),i(!0)},className:"mt-2 text-xs text-primary hover:text-primary/90",children:"Add a note or reminder"})]})]})]}),$&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",onClick:()=>{d(null),i(!1)},children:e.jsxs("div",{className:"bg-card border border-border rounded-2xl w-full max-w-md shadow-2xl",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[e.jsx("h2",{className:"text-lg font-bold text-foreground",children:"Add Note"}),e.jsx("button",{onClick:()=>{d(null),i(!1)},className:"p-1 rounded-lg hover:bg-muted text-muted-foreground",children:e.jsx(pe,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[v&&e.jsx("div",{className:"text-sm text-red-400 bg-red-500/10 border border-red-500/20 rounded-xl p-3",children:v}),e.jsxs("div",{children:[e.jsx("label",{className:p,children:"Date"}),e.jsx("input",{type:"date",value:n,onChange:s=>N(s.target.value),className:u})]}),e.jsxs("div",{children:[e.jsx("label",{className:p,children:"Title *"}),e.jsx("input",{value:t.title,onChange:s=>c({...t,title:s.target.value}),className:u,placeholder:"e.g. Order plasterboard"})]}),e.jsxs("div",{children:[e.jsx("label",{className:p,children:"Description"}),e.jsx("textarea",{value:t.description,onChange:s=>c({...t,description:s.target.value}),rows:2,className:`${u} resize-none`})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:p,children:"Type"}),e.jsx("select",{value:t.note_type,onChange:s=>c({...t,note_type:s.target.value}),className:u,children:M.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:p,children:"Priority"}),e.jsxs("select",{value:t.priority,onChange:s=>c({...t,priority:s.target.value}),className:u,children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:p,children:"Link to Project (optional)"}),e.jsxs("select",{value:t.project_id,onChange:s=>c({...t,project_id:s.target.value}),className:u,children:[e.jsx("option",{value:"",children:"None (General)"}),L.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{onClick:()=>{d(null),i(!1)},className:"flex-1 py-2.5 rounded-lg bg-muted text-foreground hover:bg-muted/80 text-sm font-medium",children:"Cancel"}),e.jsx("button",{onClick:Y,disabled:!t.title.trim(),className:"flex-1 py-2.5 rounded-lg bg-primary hover:bg-primary/90 text-primary-foreground text-sm font-bold disabled:opacity-50",children:"Add Note"})]})]})]})})]})};export{_e as default};
