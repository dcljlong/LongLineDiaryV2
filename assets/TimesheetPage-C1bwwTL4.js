import{r as d,C as w,D as $,L as W,j as e,R as H,M as J}from"./vendor-BUGsBopJ.js";import{G as R,H as Y,w as _}from"./index-Cw_rgY9l.js";import{Y as K,Z as z,K as G,P as Z}from"./icons-BH71IJCZ.js";import"./radix-DOd9NWOq.js";import"./tanstack-D2p4VxNq.js";import"./router-DTOaVcvx.js";import"./supabase-BqdusSG3.js";const i="lld-input px-2 py-1.5 rounded-lg text-xs",S=n=>({id:J(),startTime:"",lunch:!1,lunchMinutes:n,finishTime:"",jobNo:"",analysisCode:"",other:""}),ee=()=>{const[n,F]=d.useState(null),[b,k]=d.useState(""),[h,T]=d.useState(w(new Date,"yyyy-MM-dd")),[j,C]=d.useState(""),[g,M]=d.useState(""),[u,N]=d.useState({name:"",date:""}),[p,v]=d.useState({name:"",date:""}),[m,f]=d.useState([]);d.useEffect(()=>{R().then(s=>F(s)).catch(console.error)},[]),d.useEffect(()=>{if(!n||!h)return;const s=n.timesheetPeriod===2?14:7,t=$(h),a=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],r=[];for(let c=s-1;c>=0;c--){const l=W(t,c),x=w(l,"yyyy-MM-dd"),y=m.find(L=>L.date===x);r.push({day:a[l.getDay()],date:x,lines:(y==null?void 0:y.lines)||[S(n.lunchDefaultMinutes)]})}f(r)},[h,n==null?void 0:n.timesheetPeriod]);const o=(s,t,a)=>{f(r=>r.map((c,l)=>l===s?{...c,lines:c.lines.map(x=>x.id===t?{...x,...a}:x)}:c))},A=s=>{n&&f(t=>t.map((a,r)=>r===s?{...a,lines:[...a.lines,S(n.lunchDefaultMinutes)]}:a))},P=(s,t)=>{n&&f(a=>a.map((r,c)=>{if(c!==s)return r;const l=r.lines.filter(x=>x.id!==t);return{...r,lines:l.length===0?[S(n.lunchDefaultMinutes)]:l}}))},D=s=>_(s.startTime,s.finishTime,s.lunch?s.lunchMinutes:0),E=s=>s.lines.reduce((t,a)=>t+(a.startTime&&a.finishTime?D(a):0),0),O=d.useMemo(()=>m.reduce((s,t)=>s+E(t),0),[m]);return d.useEffect(()=>{m.length>0&&localStorage.setItem("sc_timesheet",JSON.stringify({employeeName:b,weekEnding:h,messages:j,nightsAway:g,staffSignOff:u,managerSignOff:p,days:m}))},[b,h,j,g,u,p,m]),d.useEffect(()=>{const s=localStorage.getItem("sc_timesheet");if(s)try{const t=JSON.parse(s);t.employeeName&&k(t.employeeName),t.weekEnding&&T(t.weekEnding),t.messages&&C(t.messages),t.nightsAway&&M(t.nightsAway),t.staffSignOff&&N(t.staffSignOff),t.managerSignOff&&v(t.managerSignOff),t.days&&f(t.days)}catch{}},[]),n?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Timesheet"}),e.jsxs("p",{className:"text-slate-400 text-sm mt-1",children:[n.timesheetPeriod===2?"Fortnightly":"Weekly"," timesheet"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{className:"flex items-center gap-2 px-3 py-2 rounded-lg bg-emerald-500/10 border border-emerald-500/20 text-emerald-400 text-xs font-medium hover:bg-emerald-500/20 transition-colors",children:[e.jsx(K,{className:"w-4 h-4"}),"Export Excel"]}),e.jsxs("button",{className:"flex items-center gap-2 px-3 py-2 rounded-lg bg-blue-500/10 border border-blue-500/20 text-blue-400 text-xs font-medium hover:bg-blue-500/20 transition-colors",children:[e.jsx(z,{className:"w-4 h-4"}),"Export PDF"]})]})]}),e.jsx("div",{className:"bg-slate-800/60 border border-slate-700/50 rounded-xl p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-400 mb-1",children:"Employee Name"}),e.jsx("input",{value:b,onChange:s=>k(s.target.value),className:`w-full ${i}`,placeholder:"Your name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-400 mb-1",children:"Week Ending"}),e.jsx("input",{type:"date",value:h,onChange:s=>T(s.target.value),className:`w-full ${i}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-400 mb-1",children:"Period"}),e.jsx("div",{className:"text-sm text-white mt-1",children:n.timesheetPeriod===2?"2 Weeks":"1 Week"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-400 mb-1",children:"Week Total"}),e.jsxs("div",{className:"text-2xl font-bold text-amber-400",children:[O.toFixed(2)," hrs"]})]})]})}),e.jsx("div",{className:"bg-slate-800/60 border border-slate-700/50 rounded-xl overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-700/50",children:[e.jsx("th",{className:"py-3 px-3 text-xs font-semibold text-slate-400 w-36",children:"Day / Date"}),e.jsx("th",{className:"py-3 px-3 text-xs font-semibold text-slate-400",children:"Start"}),e.jsx("th",{className:"py-3 px-3 text-xs font-semibold text-slate-400",children:"Lunch"}),e.jsx("th",{className:"py-3 px-3 text-xs font-semibold text-slate-400",children:"Finish"}),e.jsx("th",{className:"py-3 px-3 text-xs font-semibold text-slate-400 text-right",children:"Hours"}),e.jsx("th",{className:"py-3 px-3 text-xs font-semibold text-slate-400",children:"Job No."}),e.jsx("th",{className:"py-3 px-3 text-xs font-semibold text-slate-400",children:"Analysis Code"}),e.jsx("th",{className:"py-3 px-3 text-xs font-semibold text-slate-400",children:"Other"}),e.jsx("th",{className:"py-3 px-3 text-xs font-semibold text-slate-400 w-16"})]})}),e.jsx("tbody",{children:m.map((s,t)=>e.jsxs(H.Fragment,{children:[s.lines.map((a,r)=>{const c=a.startTime&&a.finishTime?D(a):0;return e.jsxs("tr",{className:"border-b border-slate-700/20 hover:bg-slate-700/20",children:[e.jsx("td",{className:"py-2 px-3",children:r===0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-bold text-white",children:s.day}),e.jsx("div",{className:"text-[10px] text-slate-400",children:w($(s.date),"dd/MM")}),e.jsxs("div",{className:"text-[10px] text-amber-400/70 mt-0.5",children:["Day: ",E(s).toFixed(2),"h"]})]})}),e.jsx("td",{className:"py-2 px-3",children:e.jsx("input",{type:"time",value:a.startTime,onChange:l=>o(t,a.id,{startTime:l.target.value}),onFocus:()=>{a.startTime||o(t,a.id,{startTime:"07:00"})},className:`w-24 ${i}`})}),e.jsx("td",{className:"py-2 px-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:a.lunch,onChange:l=>o(t,a.id,{lunch:l.target.checked}),className:"w-4 h-4 rounded border-slate-500 bg-slate-700 text-amber-500"}),a.lunch&&e.jsxs("select",{value:a.lunchMinutes,onChange:l=>o(t,a.id,{lunchMinutes:Number(l.target.value)}),className:`w-16 ${i}`,children:[e.jsx("option",{value:30,children:"0:30"}),e.jsx("option",{value:60,children:"1:00"})]})]})}),e.jsx("td",{className:"py-2 px-3",children:e.jsx("input",{type:"time",value:a.finishTime,onChange:l=>o(t,a.id,{finishTime:l.target.value}),onFocus:()=>{a.finishTime||o(t,a.id,{finishTime:"16:30"})},className:`w-24 ${i}`})}),e.jsx("td",{className:"py-2 px-3 text-right",children:e.jsx("span",{className:"text-sm font-bold text-white",children:c>0?c.toFixed(2):""})}),e.jsx("td",{className:"py-2 px-3",children:e.jsx("input",{value:a.jobNo,onChange:l=>o(t,a.id,{jobNo:l.target.value}),className:`w-36 ${i}`,placeholder:"e.g. 1234 - Job"})}),e.jsx("td",{className:"py-2 px-3",children:e.jsxs("select",{value:a.analysisCode,onChange:l=>o(t,a.id,{analysisCode:l.target.value}),className:`w-40 ${i}`,children:[e.jsx("option",{value:"",children:"—"}),Y.map(l=>e.jsxs("option",{value:l.code,children:[l.code," — ",l.label]},l.code))]})}),e.jsx("td",{className:"py-2 px-3",children:e.jsx("input",{value:a.other,onChange:l=>o(t,a.id,{other:l.target.value}),className:`w-full min-w-[120px] ${i}`})}),e.jsx("td",{className:"py-2 px-3",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>P(t,a.id),className:"p-1 rounded hover:bg-red-500/20 text-red-400",children:e.jsx(G,{className:"w-3.5 h-3.5"})}),r===s.lines.length-1&&e.jsx("button",{onClick:()=>A(t),className:"p-1 rounded hover:bg-emerald-500/20 text-emerald-400",children:e.jsx(Z,{className:"w-3.5 h-3.5"})})]})})]},a.id)}),e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"h-1 bg-slate-700/20"})})]},s.date))}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"border-t-2 border-slate-600",children:[e.jsx("td",{colSpan:4,className:"py-3 px-3 text-sm font-bold text-white",children:"WEEK TOTAL"}),e.jsx("td",{className:"py-3 px-3 text-right text-lg font-bold text-amber-400",children:O.toFixed(2)}),e.jsx("td",{colSpan:4})]})})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-slate-800/60 border border-slate-700/50 rounded-xl p-4",children:[e.jsx("label",{className:"block text-xs font-semibold text-slate-400 mb-2",children:"Messages"}),e.jsx("textarea",{value:j,onChange:s=>C(s.target.value),rows:3,className:`w-full ${i} resize-none`,placeholder:"Any messages or notes..."}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"block text-xs font-semibold text-slate-400 mb-1",children:"No. Nights Away"}),e.jsx("input",{value:g,onChange:s=>M(s.target.value),className:`w-full ${i}`})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-slate-800/60 border border-slate-700/50 rounded-xl p-4",children:[e.jsx("h4",{className:"text-xs font-bold text-white mb-2",children:"Staff Sign-off"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] text-slate-500 mb-1",children:"Name"}),e.jsx("input",{value:u.name,onChange:s=>N({...u,name:s.target.value}),className:`w-full ${i}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] text-slate-500 mb-1",children:"Date"}),e.jsx("input",{type:"date",value:u.date,onChange:s=>N({...u,date:s.target.value}),className:`w-full ${i}`})]})]})]}),e.jsxs("div",{className:"bg-slate-800/60 border border-slate-700/50 rounded-xl p-4",children:[e.jsx("h4",{className:"text-xs font-bold text-white mb-2",children:"Site Manager Sign-off"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] text-slate-500 mb-1",children:"Name"}),e.jsx("input",{value:p.name,onChange:s=>v({...p,name:s.target.value}),className:`w-full ${i}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] text-slate-500 mb-1",children:"Date"}),e.jsx("input",{type:"date",value:p.date,onChange:s=>v({...p,date:s.target.value}),className:`w-full ${i}`})]})]})]})]})]})]}):e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-amber-400"})})};export{ee as default};
