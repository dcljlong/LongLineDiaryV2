import{r as o,C as w,D as $,L as W,j as e,R as H,M as J}from"./vendor-BUGsBopJ.js";import{G as R,H as Y,w as _}from"./index-DA7Mnyi7.js";import{Y as K,Z as z,K as G,P as Z}from"./icons-BH71IJCZ.js";import"./radix-DOd9NWOq.js";import"./tanstack-D2p4VxNq.js";import"./router-DTOaVcvx.js";import"./supabase-BqdusSG3.js";const n="lld-input px-2 py-1.5 rounded-lg text-xs",S=l=>({id:J(),startTime:"",lunch:!1,lunchMinutes:l,finishTime:"",jobNo:"",analysisCode:"",other:""}),ee=()=>{const[l,F]=o.useState(null),[g,k]=o.useState(""),[h,T]=o.useState(w(new Date,"yyyy-MM-dd")),[b,C]=o.useState(""),[j,M]=o.useState(""),[u,N]=o.useState({name:"",date:""}),[f,y]=o.useState({name:"",date:""}),[m,p]=o.useState([]);o.useEffect(()=>{R().then(s=>F(s)).catch(console.error)},[]),o.useEffect(()=>{if(!l||!h)return;const s=l.timesheetPeriod===2?14:7,t=$(h),a=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],d=[];for(let i=s-1;i>=0;i--){const r=W(t,i),x=w(r,"yyyy-MM-dd"),v=m.find(L=>L.date===x);d.push({day:a[r.getDay()],date:x,lines:(v==null?void 0:v.lines)||[S(l.lunchDefaultMinutes)]})}p(d)},[h,l==null?void 0:l.timesheetPeriod]);const c=(s,t,a)=>{p(d=>d.map((i,r)=>r===s?{...i,lines:i.lines.map(x=>x.id===t?{...x,...a}:x)}:i))},A=s=>{l&&p(t=>t.map((a,d)=>d===s?{...a,lines:[...a.lines,S(l.lunchDefaultMinutes)]}:a))},P=(s,t)=>{l&&p(a=>a.map((d,i)=>{if(i!==s)return d;const r=d.lines.filter(x=>x.id!==t);return{...d,lines:r.length===0?[S(l.lunchDefaultMinutes)]:r}}))},D=s=>_(s.startTime,s.finishTime,s.lunch?s.lunchMinutes:0),E=s=>s.lines.reduce((t,a)=>t+(a.startTime&&a.finishTime?D(a):0),0),O=o.useMemo(()=>m.reduce((s,t)=>s+E(t),0),[m]);return o.useEffect(()=>{m.length>0&&localStorage.setItem("sc_timesheet",JSON.stringify({employeeName:g,weekEnding:h,messages:b,nightsAway:j,staffSignOff:u,managerSignOff:f,days:m}))},[g,h,b,j,u,f,m]),o.useEffect(()=>{const s=localStorage.getItem("sc_timesheet");if(s)try{const t=JSON.parse(s);t.employeeName&&k(t.employeeName),t.weekEnding&&T(t.weekEnding),t.messages&&C(t.messages),t.nightsAway&&M(t.nightsAway),t.staffSignOff&&N(t.staffSignOff),t.managerSignOff&&y(t.managerSignOff),t.days&&p(t.days)}catch{}},[]),l?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Timesheet"}),e.jsxs("p",{className:"text-muted-foreground text-sm mt-1",children:[l.timesheetPeriod===2?"Fortnightly":"Weekly"," timesheet"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{className:"flex items-center gap-2 px-3 py-2 rounded-lg bg-primary border border-primary text-primary-foreground text-xs font-semibold hover:bg-primary/90 transition-colors",children:[e.jsx(K,{className:"w-4 h-4"}),"Export Excel"]}),e.jsxs("button",{className:"flex items-center gap-2 px-3 py-2 rounded-lg bg-primary border border-primary text-primary-foreground text-xs font-semibold hover:bg-primary/90 transition-colors",children:[e.jsx(z,{className:"w-4 h-4"}),"Export PDF"]})]})]}),e.jsx("div",{className:"bg-card border border-border rounded-xl p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-muted-foreground mb-1",children:"Employee Name"}),e.jsx("input",{value:g,onChange:s=>k(s.target.value),className:`w-full ${n}`,placeholder:"Your name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-muted-foreground mb-1",children:"Week Ending"}),e.jsx("input",{type:"date",value:h,onChange:s=>T(s.target.value),className:`w-full ${n}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-muted-foreground mb-1",children:"Period"}),e.jsx("div",{className:"text-sm text-foreground mt-1",children:l.timesheetPeriod===2?"2 Weeks":"1 Week"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-muted-foreground mb-1",children:"Week Total"}),e.jsxs("div",{className:"text-2xl font-bold text-primary font-extrabold",children:[O.toFixed(2)," hrs"]})]})]})}),e.jsx("div",{className:"bg-card border border-border rounded-xl overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border",children:[e.jsx("th",{className:"py-3 px-3 text-xs font-semibold text-foreground/80 w-36",children:"Day / Date"}),e.jsx("th",{className:"py-3 px-3 text-xs font-semibold text-foreground/80",children:"Start"}),e.jsx("th",{className:"py-3 px-3 text-xs font-semibold text-foreground/80",children:"Lunch"}),e.jsx("th",{className:"py-3 px-3 text-xs font-semibold text-foreground/80",children:"Finish"}),e.jsx("th",{className:"py-3 px-3 text-xs font-semibold text-foreground/80 text-right",children:"Hours"}),e.jsx("th",{className:"py-3 px-3 text-xs font-semibold text-foreground/80",children:"Job No."}),e.jsx("th",{className:"py-3 px-3 text-xs font-semibold text-foreground/80",children:"Analysis Code"}),e.jsx("th",{className:"py-3 px-3 text-xs font-semibold text-foreground/80",children:"Other"}),e.jsx("th",{className:"py-3 px-3 text-xs font-semibold text-foreground/80 w-16"})]})}),e.jsx("tbody",{children:m.map((s,t)=>e.jsxs(H.Fragment,{children:[s.lines.map((a,d)=>{const i=a.startTime&&a.finishTime?D(a):0;return e.jsxs("tr",{className:"border-b border-border/60 hover:bg-muted/60",children:[e.jsx("td",{className:"py-2 px-3",children:d===0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-bold text-foreground",children:s.day}),e.jsx("div",{className:"text-[10px] text-muted-foreground",children:w($(s.date),"dd/MM")}),e.jsxs("div",{className:"text-[10px] text-primary font-semibold mt-0.5",children:["Day: ",E(s).toFixed(2),"h"]})]})}),e.jsx("td",{className:"py-2 px-3",children:e.jsx("input",{type:"time",value:a.startTime,onChange:r=>c(t,a.id,{startTime:r.target.value}),onFocus:()=>{a.startTime||c(t,a.id,{startTime:"07:00"})},className:`w-24 ${n}`})}),e.jsx("td",{className:"py-2 px-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:a.lunch,onChange:r=>c(t,a.id,{lunch:r.target.checked}),className:"w-4 h-4 rounded border-border bg-muted text-primary font-extrabold"}),a.lunch&&e.jsxs("select",{value:a.lunchMinutes,onChange:r=>c(t,a.id,{lunchMinutes:Number(r.target.value)}),className:`w-16 ${n}`,children:[e.jsx("option",{value:30,children:"0:30"}),e.jsx("option",{value:60,children:"1:00"})]})]})}),e.jsx("td",{className:"py-2 px-3",children:e.jsx("input",{type:"time",value:a.finishTime,onChange:r=>c(t,a.id,{finishTime:r.target.value}),onFocus:()=>{a.finishTime||c(t,a.id,{finishTime:"16:30"})},className:`w-24 ${n}`})}),e.jsx("td",{className:"py-2 px-3 text-right",children:e.jsx("span",{className:"text-sm font-bold text-foreground",children:i>0?i.toFixed(2):""})}),e.jsx("td",{className:"py-2 px-3",children:e.jsx("input",{value:a.jobNo,onChange:r=>c(t,a.id,{jobNo:r.target.value}),className:`w-36 ${n}`,placeholder:"e.g. 1234 - Job"})}),e.jsx("td",{className:"py-2 px-3",children:e.jsxs("select",{value:a.analysisCode,onChange:r=>c(t,a.id,{analysisCode:r.target.value}),className:`w-40 ${n}`,children:[e.jsx("option",{value:"",children:"—"}),Y.map(r=>e.jsxs("option",{value:r.code,children:[r.code," — ",r.label]},r.code))]})}),e.jsx("td",{className:"py-2 px-3",children:e.jsx("input",{value:a.other,onChange:r=>c(t,a.id,{other:r.target.value}),className:`w-full min-w-[120px] ${n}`})}),e.jsx("td",{className:"py-2 px-3",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>P(t,a.id),className:"p-1 rounded hover:bg-red-500/20 text-red-400",children:e.jsx(G,{className:"w-3.5 h-3.5"})}),d===s.lines.length-1&&e.jsx("button",{onClick:()=>A(t),className:"p-1 rounded hover:bg-emerald-500/20 text-emerald-400",children:e.jsx(Z,{className:"w-3.5 h-3.5"})})]})})]},a.id)}),e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"h-1 bg-muted/60"})})]},s.date))}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"border-t-2 border-border",children:[e.jsx("td",{colSpan:4,className:"py-3 px-3 text-sm font-bold text-foreground",children:"WEEK TOTAL"}),e.jsx("td",{className:"py-3 px-3 text-right text-lg font-bold text-primary font-extrabold",children:O.toFixed(2)}),e.jsx("td",{colSpan:4})]})})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-card border border-border rounded-xl p-4",children:[e.jsx("label",{className:"block text-xs font-semibold text-foreground/80 mb-2",children:"Messages"}),e.jsx("textarea",{value:b,onChange:s=>C(s.target.value),rows:3,className:`w-full ${n} resize-none`,placeholder:"Any messages or notes..."}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"block text-xs font-semibold text-foreground/80 mb-1",children:"No. Nights Away"}),e.jsx("input",{value:j,onChange:s=>M(s.target.value),className:`w-full ${n}`})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-card border border-border rounded-xl p-4",children:[e.jsx("h4",{className:"text-xs font-bold text-foreground mb-2",children:"Staff Sign-off"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] text-primary mb-1",children:"Name"}),e.jsx("input",{value:u.name,onChange:s=>N({...u,name:s.target.value}),className:`w-full ${n}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] text-primary mb-1",children:"Date"}),e.jsx("input",{type:"date",value:u.date,onChange:s=>N({...u,date:s.target.value}),className:`w-full ${n}`})]})]})]}),e.jsxs("div",{className:"bg-card border border-border rounded-xl p-4",children:[e.jsx("h4",{className:"text-xs font-bold text-foreground mb-2",children:"Site Manager Sign-off"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] text-primary mb-1",children:"Name"}),e.jsx("input",{value:f.name,onChange:s=>y({...f,name:s.target.value}),className:`w-full ${n}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] text-primary mb-1",children:"Date"}),e.jsx("input",{type:"date",value:f.date,onChange:s=>y({...f,date:s.target.value}),className:`w-full ${n}`})]})]})]})]})]})]}):e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-amber-400"})})};export{ee as default};
