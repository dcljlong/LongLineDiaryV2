import{r as c,j as e}from"./vendor-BUGsBopJ.js";import{f as T,a as $,t as f,b as M,c as H,d as y,e as N,g as z}from"./index-C9T-8GFa.js";import{P as v}from"./PriorityBadge-B6ufke2k.js";import{y as F,T as J,b as W,z as p,m as B,C as O,P as R,A as u,W as _,D as w,k as V,G,I as K,H as Q,J as X}from"./icons-BH71IJCZ.js";import"./radix-DOd9NWOq.js";import"./tanstack-D2p4VxNq.js";import"./router-DTOaVcvx.js";import"./supabase-BqdusSG3.js";const le=({onNavigate:d,onQuickAdd:b})=>{const[h,k]=c.useState([]),[m,C]=c.useState([]),[n,P]=c.useState(null),[a,D]=c.useState(null),[x,I]=c.useState("all"),[A,g]=c.useState(!0);c.useEffect(()=>{q()},[]);const q=async()=>{g(!0);try{const[r,t,s,o]=await Promise.all([T(),$({date:f()}),M(),H()]);k(r),C(t),P(s),D(o)}catch(r){console.error(r)}g(!1)},j=c.useMemo(()=>{if(!a)return[];const r=[];return a.activities.forEach(t=>{var s,o,l,i;return r.push({...t,_type:"activity",_dueDate:t.due_date,_project:((o=(s=t.daily_logs)==null?void 0:s.projects)==null?void 0:o.name)||"Unknown",_jobNumber:((i=(l=t.daily_logs)==null?void 0:l.projects)==null?void 0:i.job_number)||""})}),a.materials.forEach(t=>{var s,o,l,i;return r.push({...t,_type:"material",_dueDate:t.required_date,_project:((o=(s=t.daily_logs)==null?void 0:s.projects)==null?void 0:o.name)||"Unknown",_jobNumber:((i=(l=t.daily_logs)==null?void 0:l.projects)==null?void 0:i.job_number)||""})}),a.equipment.forEach(t=>{var s,o,l,i;return r.push({...t,_type:"equipment",_dueDate:t.due_date,_project:((o=(s=t.daily_logs)==null?void 0:s.projects)==null?void 0:o.name)||"Unknown",_jobNumber:((i=(l=t.daily_logs)==null?void 0:l.projects)==null?void 0:i.job_number)||""})}),a.crew.forEach(t=>{var s,o,l,i;return r.push({...t,_type:"crew",_dueDate:t.due_date,_project:((o=(s=t.daily_logs)==null?void 0:s.projects)==null?void 0:o.name)||"Unknown",_jobNumber:((i=(l=t.daily_logs)==null?void 0:l.projects)==null?void 0:i.job_number)||""})}),r.map(t=>({...t,_priority:y(t._dueDate)})).filter(t=>x==="all"||t._priority===x).sort((t,s)=>{const o={high:0,medium:1,low:2};return o[t._priority]-o[s._priority]})},[a,x]),L=n?[{label:"Active Projects",value:n.activeProjects,icon:F,color:"from-blue-500 to-blue-600",textColor:"text-blue-400"},{label:"High Priority",value:n.highPriorityLogs,icon:J,color:"from-red-500 to-red-600",textColor:"text-danger"},{label:"Overdue Items",value:n.totalOverdue,icon:W,color:"from-primary to-primary",textColor:"text-primary"},{label:"Pending Materials",value:n.pendingMaterials,icon:p,color:"from-purple-500 to-purple-600",textColor:"text-purple-400"},{label:"Safety Incidents",value:n.safetyIncidents,icon:B,color:"from-emerald-500 to-emerald-600",textColor:"text-emerald-400"},{label:"Total Logs",value:n.totalLogs,icon:O,color:"from-indigo-500 to-indigo-600",textColor:"text-indigo-400"}]:[],S=[{label:"Work Activity",icon:u,color:"bg-blue-500/10 text-blue-400 border-blue-500/20",action:()=>d("daily-logs",{tab:"activities"})},{label:"Materials",icon:p,color:"bg-purple-500/10 text-purple-400 border-purple-500/20",action:()=>d("daily-logs",{tab:"materials"})},{label:"Equipment",icon:_,color:"bg-primary/10 text-primary border-primary/20",action:()=>d("daily-logs",{tab:"equipment"})},{label:"Crew",icon:w,color:"bg-emerald-500/10 text-emerald-400 border-emerald-500/20",action:()=>d("daily-logs",{tab:"crew"})},{label:"Visitor",icon:V,color:"bg-indigo-500/10 text-indigo-400 border-indigo-500/20",action:()=>d("daily-logs",{tab:"visitors"})},{label:"Delivery",icon:G,color:"bg-rose-500/10 text-rose-400 border-rose-500/20",action:()=>d("calendar",{type:"delivery"})}],E={activity:u,material:p,equipment:_,crew:w},U={activity:"Activity",material:"Material",equipment:"Equipment",crew:"Crew"};return A?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Command Center"}),e.jsxs("p",{className:"text-muted-foreground text-sm mt-1",children:[N(f())," â€” ",m.length," job",m.length!==1?"s":""," logged today"]})]}),e.jsxs("button",{onClick:b,className:"flex items-center gap-2 px-4 py-2.5 rounded-lg bg-primary hover:bg-primary/90 text-primary-foreground font-semibold text-sm transition-colors",children:[e.jsx(R,{className:"w-4 h-4"}),"New Job"]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3",children:L.map((r,t)=>{const s=r.icon;return e.jsxs("div",{className:"bg-card border border-border rounded-xl p-4 hover:border-border/50 transition-colors",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx("div",{className:`w-8 h-8 rounded-lg bg-gradient-to-br ${r.color} flex items-center justify-center`,children:e.jsx(s,{className:"w-4 h-4 text-foreground"})})}),e.jsx("div",{className:"text-2xl font-bold text-foreground",children:r.value}),e.jsx("div",{className:"text-xs text-muted-foreground mt-0.5",children:r.label})]},t)})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-semibold text-foreground uppercase tracking-wider mb-3",children:"Quick Add"}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-6 gap-2",children:S.map((r,t)=>{const s=r.icon;return e.jsxs("button",{onClick:r.action,className:`flex flex-col items-center gap-2 p-3 rounded-xl border ${r.color} hover:scale-105 transition-transform`,children:[e.jsx(s,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs font-medium",children:r.label})]},t)})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-sm font-semibold text-foreground uppercase tracking-wider",children:"Active Projects"}),e.jsxs("button",{onClick:()=>d("daily-logs"),className:"text-xs text-primary hover:text-primary/90 flex items-center gap-1",children:["View All ",e.jsx(K,{className:"w-3 h-3"})]})]}),e.jsx("div",{className:"space-y-2 max-h-[500px] overflow-y-auto pr-1",children:h.filter(r=>r.status==="active").length===0?e.jsxs("div",{className:"bg-card border border-border rounded-xl p-6 text-center",children:[e.jsx(Q,{className:"w-8 h-8 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No active projects"}),e.jsx("button",{onClick:b,className:"mt-2 text-xs text-primary hover:text-primary/90",children:"Create your first job"})]}):h.filter(r=>r.status==="active").map(r=>{const t=m.filter(s=>s.project_id===r.id);return e.jsx("button",{onClick:()=>d("daily-logs",{project_id:r.id}),className:"w-full text-left bg-card border border-border rounded-xl p-4 hover:border-primary/30 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"text-xs font-mono text-primary bg-primary/10 px-1.5 py-0.5 rounded",children:r.job_number||"#"})}),e.jsx("h3",{className:"text-sm font-semibold text-foreground mt-1 truncate",children:r.name}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:r.location||r.client||"No location"})]}),e.jsx("div",{className:"flex flex-col items-end gap-1 ml-2",children:t.length>0&&e.jsx("span",{className:"text-[10px] bg-emerald-500/10 text-emerald-400 px-1.5 py-0.5 rounded-full border border-emerald-500/20",children:"Logged today"})})]})},r.id)})})]}),e.jsxs("div",{className:"lg:col-span-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-sm font-semibold text-foreground uppercase tracking-wider",children:"Priority Items"}),e.jsx("div",{className:"flex gap-1",children:["all","high","medium","low"].map(r=>e.jsxs("button",{onClick:()=>I(r),className:`px-2.5 py-1 rounded-lg text-xs font-medium transition-colors ${x===r?r==="high"?"bg-danger/15 text-danger border border-danger/30":r==="medium"?"bg-primary/20 text-primary border border-primary/30":r==="low"?"bg-success/15 text-success border border-success/30":"bg-muted text-foreground border border-border":"text-muted-foreground hover:text-foreground border border-transparent"}`,children:[r==="all"?"All":r.charAt(0).toUpperCase()+r.slice(1),r!=="all"&&a&&e.jsxs("span",{className:"ml-1",children:["(",[...a.activities,...a.materials,...a.equipment,...a.crew].filter(t=>y(t.due_date||t.required_date)===r).length,")"]})]},r))})]}),e.jsx("div",{className:"space-y-2 max-h-[500px] overflow-y-auto pr-1",children:j.length===0?e.jsxs("div",{className:"bg-card border border-border rounded-xl p-8 text-center",children:[e.jsx(X,{className:"w-10 h-10 text-success mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-foreground font-medium",children:"All clear!"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"No outstanding items to show"})]}):j.slice(0,20).map((r,t)=>{const s=E[r._type]||u;return e.jsx("div",{className:"bg-card border border-border rounded-xl p-3 hover:border-border/50 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-2 h-2 rounded-full mt-2 flex-shrink-0 ${z(r._priority)}`}),e.jsx(s,{className:"w-4 h-4 text-muted-foreground mt-1 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm font-medium text-foreground truncate",children:r.description||r.equipment_name||r.worker_name||"Unnamed"}),e.jsx(v,{priority:r._priority,size:"sm",showIcon:!1}),e.jsx("span",{className:"text-[10px] text-muted-foreground bg-muted px-1.5 py-0.5 rounded",children:U[r._type]})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-1 text-xs text-muted-foreground",children:[e.jsx("span",{children:r._project}),r._jobNumber&&e.jsxs("span",{className:"font-mono text-primary/60",children:["#",r._jobNumber]}),r._dueDate&&e.jsxs("span",{children:["Due: ",N(r._dueDate)]})]}),r.notes&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1 truncate",children:r.notes})]})]})},`${r._type}-${r.id}-${t}`)})})]})]}),m.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-semibold text-foreground uppercase tracking-wider mb-3",children:"Today's Jobs"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:m.map(r=>{var t,s;return e.jsxs("button",{onClick:()=>d("daily-logs",{logId:r.id}),className:"text-left bg-card border border-border rounded-xl p-4 hover:border-primary/30 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs font-mono text-primary bg-primary/10 px-1.5 py-0.5 rounded",children:((t=r.project)==null?void 0:t.job_number)||"#"}),e.jsx(v,{priority:r.priority,size:"sm"})]}),e.jsx("h3",{className:"text-sm font-semibold text-foreground",children:((s=r.project)==null?void 0:s.name)||"Unknown Project"}),e.jsxs("div",{className:"flex items-center gap-3 mt-2 text-xs text-muted-foreground",children:[r.weather&&e.jsx("span",{children:r.weather}),r.temperature&&e.jsx("span",{children:r.temperature})]}),r.critical_items&&e.jsx("div",{className:"mt-2 p-2 rounded-lg bg-danger/10 border border-danger/20",children:e.jsx("p",{className:"text-xs text-danger line-clamp-2",children:r.critical_items})})]},r.id)})})]})]})};export{le as default};
