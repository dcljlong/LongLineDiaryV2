import{j as e,r as a,F as D,K as te,E as w,L as se,M as re}from"./vendor-Coh6w-wA.js";import{t as ae,g as oe,N as M,D as le,a as de,f as ne,E as ie,s as ce,F as P,G as me,H as xe}from"./index-Cgf2erep.js";import{P as T}from"./PriorityBadge-CZTRhtYn.js";import{P as ue,g as pe,f as he,T as ge,G as be,I as fe,J as je,K as Ne,N as F,D as ye,a as ve,X as we}from"./icons-DuXLjBGX.js";import"./radix-wrHiDKbY.js";import"./tanstack-x3w5gpW7.js";import"./supabase-jRWW_51U.js";import"./router-jL34xOpu.js";function _e({projects:j,value:_,onChange:l,className:g,includeBlank:d=!0,blankLabel:b="No project",disabled:N=!1}){return e.jsxs("select",{value:_??"",disabled:N,onChange:i=>l(i.target.value?i.target.value:null),className:g,children:[d&&e.jsx("option",{value:"",children:b}),j.map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))]})}const p="lld-input w-full px-3 py-2 rounded-lg text-sm",h="block text-xs font-medium text-muted-foreground mb-1",Oe=({onNavigate:j,initialData:_})=>{const[l,g]=a.useState(new Date),[d,b]=a.useState(ae()),[N,i]=a.useState([]),[A,Ce]=a.useState({}),[ke,L]=a.useState(!1),[Se,O]=a.useState(null),$=t=>{O(t),L(!0)};async function B(t){try{const{data:r,error:s}=await ce.from("action_items").select("*").eq("id",t).single();if(!r){P({title:"Action not found",description:"Linked action item was not found (it may have been deleted).",variant:"destructive"});return}if(s)throw s;$(r)}catch(r){console.error("Failed to load action item",r),P({title:"Open failed",description:"Could not open linked action item.",variant:"destructive"})}}const[z,Y]=a.useState([]),[R,q]=a.useState([]),[G,c]=a.useState(!1),[Ee,C]=a.useState(!0),[k,n]=a.useState(null),[o,m]=a.useState({title:"",description:"",note_type:"note",priority:"low",project_id:""}),f=async()=>{C(!0);try{const[t,r,s]=await Promise.all([le(l.getMonth(),l.getFullYear()),de(),ne()]);i(t),Y(r),q(s)}catch(t){console.error(t),n((t==null?void 0:t.message)||"Failed to add note")}C(!1)};a.useEffect(()=>{f()},[l]),a.useEffect(()=>{try{const t=D(d);(t.getFullYear()!==l.getFullYear()||t.getMonth()!==l.getMonth())&&g(t)}catch{}},[d]);const J=oe(l.getFullYear(),l.getMonth()),S=t=>{const r=z.filter(u=>u.log_date===t),s=N.filter(u=>u.note_date===t);return{logs:r,notes:s}},x=S(d),H=async()=>{try{n(null),await xe({...o,note_date:d,project_id:o.project_id||null,is_completed:!1}),m({title:"",description:"",note_type:"note",priority:"low",project_id:""}),c(!1),setEditNoteId(null),f()}catch(t){console.error(t),n((t==null?void 0:t.message)||"Failed to add note")}};function K(t){n(null),setEditNoteId(t.id),m({title:t.title||"",description:t.description||"",note_type:t.note_type||"note",priority:t.priority||"med",project_id:t.project_id||null,action_item_id:t.action_item_id||null}),c(!0)}const U=async(t,r)=>{await ie(t,{is_completed:r}),f()},W=async t=>{await me(t),f()},X={note:F,reminder:Ne,meeting:je,deadline:fe,inspection:be,delivery:ge},Q={note:"bg-blue-500",reminder:"bg-purple-500",meeting:"bg-indigo-500",deadline:"bg-red-500",inspection:"bg-primary",delivery:"bg-green-500"};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Calendar"}),e.jsxs("button",{onClick:()=>{n(null),setEditNoteId(null),c(!0)},className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-primary hover:bg-primary/90 text-primary-foreground text-sm font-semibold transition-colors",children:[e.jsx(ue,{className:"w-4 h-4"}),"Add Note"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 bg-card border border-border rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:()=>g(te(l)),className:"p-2 rounded-lg hover:bg-muted text-muted-foreground",children:e.jsx(pe,{className:"w-5 h-5"})}),e.jsx("h2",{className:"text-lg font-bold text-foreground",children:w(l,"MMMM yyyy")}),e.jsx("button",{onClick:()=>g(se(l,1)),className:"p-2 rounded-lg hover:bg-muted text-muted-foreground",children:e.jsx(he,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"grid grid-cols-7 gap-1 mb-1",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(t=>e.jsx("div",{className:"text-center text-xs font-medium text-muted-foreground py-2",children:t},t))}),J.map((t,r)=>e.jsx("div",{className:"grid grid-cols-7 gap-1",children:t.map((s,u)=>{if(!s)return e.jsx("div",{className:"aspect-square"},u);const y=w(s,"yyyy-MM-dd"),E=y===d,I=re(s,new Date),v=S(y),V=v.logs.length>0;return v.notes.length>0,e.jsxs("button",{onClick:()=>b(y),className:`aspect-square p-1 rounded-lg flex flex-col items-start transition-colors relative ${E?"bg-primary/20 border-2 border-primary/50":I?"bg-muted/70 border border-border":"hover:bg-muted/30 border border-transparent"}`,children:[e.jsx("span",{className:`text-xs font-medium ${E?"text-primary":"text-foreground"}`,children:s.getDate()}),e.jsxs("div",{className:"flex gap-0.5 mt-auto flex-wrap",children:[V&&e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-primary"}),v.notes.slice(0,3).map((Z,ee)=>e.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${Q[Z.note_type]||"bg-blue-500"}`},ee))]})]},u)})},r)),e.jsxs("div",{className:"flex flex-wrap gap-3 mt-4 pt-3 border-t border-border",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-primary"})," Jobs"]}),M.map(t=>e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${t.color}`})," ",t.label]},t.value))]})]}),e.jsxs("div",{className:"bg-card border border-border rounded-xl p-4 overflow-y-auto max-h-[700px]",children:[e.jsx("h3",{className:"text-sm font-bold text-foreground mb-3",children:w(D(d),"EEEE, dd MMMM yyyy")}),x.logs.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-xs font-semibold text-foreground/80 uppercase mb-2",children:"Jobs"}),e.jsx("div",{className:"space-y-2",children:x.logs.map(t=>{var r,s;return e.jsxs("button",{onClick:()=>j("daily-logs",{logId:t.id}),className:"w-full text-left p-3 rounded-lg bg-primary/10 border border-amber-500/20 hover:border-amber-500/40 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs font-mono text-primary",children:["#",((r=t.project)==null?void 0:r.job_number)||"â€”"]}),e.jsx(T,{priority:t.priority,size:"sm",showIcon:!1})]}),e.jsx("p",{className:"text-sm font-medium text-foreground mt-1",children:((s=t.project)==null?void 0:s.name)||"Unknown"}),t.weather&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[t.weather," ",t.temperature]})]},t.id)})})]}),x.notes.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-xs font-semibold text-foreground/80 uppercase mb-2",children:"Notes & Reminders"}),e.jsx("div",{className:"space-y-2",children:x.notes.map(t=>{const r=X[t.note_type]||F;return e.jsx("div",{onClick:()=>K(t),className:`p-3 rounded-lg border transition-colors ${t.is_completed?"bg-card/30 border-border opacity-60":"bg-muted/60 border-border"}`,children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("input",{type:"checkbox",checked:t.is_completed,onClick:s=>s.stopPropagation(),onChange:s=>U(t.id,s.target.checked),className:"w-4 h-4 mt-0.5 rounded border-border bg-muted text-amber-500"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(r,{className:"w-3.5 h-3.5 text-muted-foreground"}),e.jsxs("span",{className:`text-sm font-medium ${t.is_completed?"line-through text-muted-foreground":"text-foreground"}`,children:[t.title,t.action_item_id&&A[t.action_item_id]&&e.jsx("span",{className:"ml-2 inline-flex items-center rounded-full bg-emerald-500/15 border border-emerald-500/30 text-emerald-600 px-2 py-0.5 text-[10px] font-semibold",children:"Completed"})]})]}),t.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:t.description}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(T,{priority:t.priority,size:"sm",showIcon:!1}),e.jsx("span",{className:"text-[10px] text-muted-foreground capitalize",children:t.note_type})]})]}),t.action_item_id&&e.jsx("button",{onClick:s=>{s.stopPropagation(),B(t.action_item_id)},className:"px-2 py-1 rounded border border-amber-500/30 bg-amber-500/10 text-amber-600 hover:bg-amber-500/15 text-xs font-semibold",children:"Open Action"}),e.jsx("button",{onClick:s=>{s.stopPropagation(),W(t.id)},className:"p-1 rounded hover:bg-red-500/20 text-red-400",children:e.jsx(ye,{className:"w-3.5 h-3.5"})})]})},t.id)})})]}),x.logs.length===0&&x.notes.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ve,{className:"w-8 h-8 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Nothing scheduled"}),e.jsx("button",{onClick:()=>{n(null),setEditNoteId(null),c(!0)},className:"mt-2 text-xs text-primary hover:text-primary/90",children:"Add a note or reminder"})]})]})]}),G&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",onClick:()=>{n(null),c(!1),setEditNoteId(null)},children:e.jsxs("div",{className:"bg-card border border-border rounded-2xl w-full max-w-md shadow-2xl",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[e.jsx("h2",{className:"text-lg font-bold text-foreground",children:"Add Note"}),e.jsx("button",{onClick:()=>{n(null),c(!1),setEditNoteId(null)},className:"p-1 rounded-lg hover:bg-muted text-muted-foreground",children:e.jsx(we,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[k&&e.jsx("div",{className:"text-sm text-red-400 bg-red-500/10 border border-red-500/20 rounded-xl p-3",children:k}),e.jsxs("div",{children:[e.jsx("label",{className:h,children:"Date"}),e.jsx("input",{type:"date",value:d,onChange:t=>b(t.target.value),className:p})]}),e.jsxs("div",{children:[e.jsx("label",{className:h,children:"Title *"}),e.jsx("input",{value:o.title,onChange:t=>m({...o,title:t.target.value}),className:p,placeholder:"e.g. Order plasterboard"})]}),e.jsxs("div",{children:[e.jsx("label",{className:h,children:"Description"}),e.jsx("textarea",{value:o.description,onChange:t=>m({...o,description:t.target.value}),rows:2,className:`${p} resize-none`})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:h,children:"Type"}),e.jsx("select",{value:o.note_type,onChange:t=>m({...o,note_type:t.target.value}),className:p,children:M.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:h,children:"Priority"}),e.jsxs("select",{value:o.priority,onChange:t=>m({...o,priority:t.target.value}),className:p,children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:h,children:"Link to Project (optional)"}),e.jsx(_e,{projects:R,value:o.project_id,onChange:t=>m({...o,project_id:t??""}),className:p,includeBlank:!0,blankLabel:"No project"})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{onClick:()=>{n(null),c(!1),setEditNoteId(null)},className:"flex-1 py-2.5 rounded-lg bg-muted text-foreground hover:bg-muted/80 text-sm font-medium",children:"Cancel"}),e.jsx("button",{onClick:H,disabled:!o.title.trim(),className:"flex-1 py-2.5 rounded-lg bg-primary hover:bg-primary/90 text-primary-foreground text-sm font-bold disabled:opacity-50",children:"Add Note"})]})]})]})})]})};export{Oe as default};
