import{r as u,j as e}from"./vendor-Ctk_PxZ3.js";import{I as f,c}from"./index-W4YbKFuJ.js";import{X as g,_ as h,$ as j,a0 as N,y,Z as v}from"./icons-Uc_ZW2XO.js";async function w(d,r){const n=new Date().toISOString(),o={status:r,updated_at:n};r==="done"&&(o.completed_at=n),r==="cancelled"&&(o.cancelled_at=n);const{error:t}=await f.from("action_items").update(o).eq("id",d);if(t)throw t;return!0}function _(d){const r=String(d||"open").toLowerCase();return r==="open"?"open":r==="in_progress"?"in_progress":r==="blocked"?"blocked":r==="done"?"done":r==="cancelled"?"cancelled":"open"}function C(d){const r=String(d||"medium").toLowerCase();return r==="high"?"high":r==="low"?"low":"medium"}function D({open:d,item:r,onClose:n,onChanged:o}){const[t,x]=u.useState(!1),[b,p]=u.useState(null),s=u.useMemo(()=>{if(!r)return null;const i=r._title||r.title||"Unnamed",l=r._details||r.details||"",m=r._due||r.due_date||null;return{id:r.id,title:i,details:l,project:r._project||"Unknown",jobNumber:r._jobNumber||"",due:m,status:_(r.status),priority:C(r._priority||r.priority),pinned:(r._pinned??r.pinned)===!0,category:r.category?String(r.category):null,source:r.source?String(r.source):null,sourceRef:r.source_ref??null,completedAt:r.completed_at||null,cancelledAt:r.cancelled_at||null,deferUntil:r.defer_until||null}},[r]);if(!d||!s)return null;const a=async i=>{x(!0),p(null);try{await w(s.id,i),await o(),n()}catch(l){p((l==null?void 0:l.message)||"Update failed")}finally{x(!1)}};return e.jsxs("div",{className:"fixed inset-0 z-50",children:[e.jsx("button",{type:"button","aria-label":"Close",className:"absolute inset-0 bg-black/60",onClick:()=>t?null:n()}),e.jsx("div",{className:"absolute inset-x-0 top-10 mx-auto w-[95%] max-w-2xl",children:e.jsxs("div",{className:"bg-card border border-border rounded-2xl shadow-xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-start justify-between p-4 border-b border-border",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("h3",{className:"text-base font-semibold text-foreground truncate",children:s.title}),e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded border border-border bg-muted text-muted-foreground",children:s.status}),e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded border border-border bg-muted text-muted-foreground",children:s.priority}),s.category&&e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded border border-border bg-muted text-muted-foreground",children:s.category})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-1 text-xs text-muted-foreground",children:[e.jsx("span",{className:"truncate",children:s.project}),s.jobNumber&&e.jsxs("span",{className:"font-mono text-primary/70",children:["#",s.jobNumber]}),s.due&&e.jsxs("span",{children:["Due: ",c(s.due)]})]})]}),e.jsx("button",{type:"button",onClick:()=>t?null:n(),className:"p-2 rounded-lg hover:bg-muted transition-colors","aria-label":"Close",children:e.jsx(g,{className:"w-4 h-4 text-muted-foreground"})})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[s.details?e.jsxs("div",{className:"bg-muted/40 border border-border rounded-xl p-3",children:[e.jsx("div",{className:"text-xs font-semibold text-foreground mb-1",children:"Details"}),e.jsx("div",{className:"text-sm text-foreground whitespace-pre-wrap",children:s.details})]}):e.jsx("div",{className:"text-sm text-muted-foreground",children:"No details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-card border border-border rounded-xl p-3",children:[e.jsx("div",{className:"text-xs font-semibold text-foreground mb-1",children:"Operational"}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[e.jsxs("div",{children:["Status: ",e.jsx("span",{className:"text-foreground",children:s.status})]}),e.jsxs("div",{children:["Priority: ",e.jsx("span",{className:"text-foreground",children:s.priority})]}),e.jsxs("div",{children:["Pinned: ",e.jsx("span",{className:"text-foreground",children:s.pinned?"yes":"no"})]}),s.deferUntil&&e.jsxs("div",{children:["Defer until: ",e.jsx("span",{className:"text-foreground",children:c(s.deferUntil)})]}),s.completedAt&&e.jsxs("div",{children:["Completed: ",e.jsx("span",{className:"text-foreground",children:c(s.completedAt)})]}),s.cancelledAt&&e.jsxs("div",{children:["Cancelled: ",e.jsx("span",{className:"text-foreground",children:c(s.cancelledAt)})]})]})]}),e.jsxs("div",{className:"bg-card border border-border rounded-xl p-3",children:[e.jsx("div",{className:"text-xs font-semibold text-foreground mb-1",children:"Source"}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[e.jsxs("div",{children:["Source: ",e.jsx("span",{className:"text-foreground",children:s.source||"—"})]}),e.jsxs("div",{className:"break-words",children:["Ref: ",e.jsx("span",{className:"text-foreground",children:s.sourceRef?JSON.stringify(s.sourceRef):"—"})]})]})]})]}),b&&e.jsx("div",{className:"bg-danger/10 border border-danger/20 text-danger rounded-xl p-3 text-sm",children:b})]}),e.jsxs("div",{className:"p-4 border-t border-border",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-2",children:[e.jsxs("button",{type:"button",disabled:t,onClick:()=>a("open"),className:"px-3 py-2 rounded-xl border border-border bg-card hover:bg-muted transition-colors text-sm flex items-center justify-center gap-2",children:[e.jsx(h,{className:"w-4 h-4"})," Open"]}),e.jsxs("button",{type:"button",disabled:t,onClick:()=>a("in_progress"),className:"px-3 py-2 rounded-xl border border-border bg-card hover:bg-muted transition-colors text-sm flex items-center justify-center gap-2",children:[e.jsx(j,{className:"w-4 h-4"})," In Prog"]}),e.jsxs("button",{type:"button",disabled:t,onClick:()=>a("blocked"),className:"px-3 py-2 rounded-xl border border-border bg-card hover:bg-muted transition-colors text-sm flex items-center justify-center gap-2",children:[e.jsx(N,{className:"w-4 h-4"})," Blocked"]}),e.jsxs("button",{type:"button",disabled:t,onClick:()=>a("done"),className:"px-3 py-2 rounded-xl border border-success/30 bg-success/10 hover:bg-success/15 transition-colors text-sm flex items-center justify-center gap-2 text-success",children:[e.jsx(y,{className:"w-4 h-4"})," Complete"]}),e.jsxs("button",{type:"button",disabled:t,onClick:()=>a("cancelled"),className:"px-3 py-2 rounded-xl border border-danger/30 bg-danger/10 hover:bg-danger/15 transition-colors text-sm flex items-center justify-center gap-2 text-danger",children:[e.jsx(v,{className:"w-4 h-4"})," Cancel"]})]}),e.jsx("div",{className:"mt-2 text-[11px] text-muted-foreground",children:"Note: pin/unpin and defer will be added next (requires RLS-safe update paths)."})]})]})})]})}export{D as A};
