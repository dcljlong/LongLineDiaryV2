import{r,j as e}from"./vendor-Coh6w-wA.js";import{c as i,t as C,s as D}from"./index-DOjT9gM6.js";import{A as $}from"./ActionItemDetailModal-C1PQ9nlb.js";import{Z as A,G as k,t as f,_ as F}from"./icons-DuXLjBGX.js";import"./radix-wrHiDKbY.js";import"./tanstack-x3w5gpW7.js";import"./supabase-jRWW_51U.js";import"./router-jL34xOpu.js";import"./PriorityBadge-CZTRhtYn.js";const B=()=>{const[c,m]=r.useState([]),[h,x]=r.useState(!0),[d,b]=r.useState("all"),[l,j]=r.useState(""),[u,N]=r.useState(()=>{const t=new Date;t.setDate(t.getDate()-30);const s=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),S=String(t.getDate()).padStart(2,"0");return`${s}-${a}-${S}`}),[v,p]=r.useState(!1),[y,g]=r.useState(null),o=async()=>{x(!0);try{let t=D.from("action_items").select("*").in("status",["done","cancelled"]).is("deleted_at",null).gte("updated_at",new Date(u).toISOString()).order("updated_at",{ascending:!1}).limit(500);const{data:s,error:a}=await t;if(a)throw a;m(s||[])}catch(t){console.error(t),m([])}finally{x(!1)}};r.useEffect(()=>{o()},[]);const n=r.useMemo(()=>{const t=l.trim().toLowerCase();return c.filter(s=>d==="all"?!0:s.status===d).filter(s=>t?`${s.title||""} ${s.details||""} ${s.site_name||""}`.toLowerCase().includes(t):!0)},[c,d,l]),w=t=>{g({...t,_title:t.title||"Unnamed",_details:t.details||"",_project:t.site_name||"—",_jobNumber:"",_due:t.due_date,_pinned:t.pinned===!0,_priority:t.priority||"medium"}),p(!0)},_=()=>{p(!1),g(null)};return e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Archive"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Completed and cancelled items retained for reporting."})]}),e.jsxs("button",{onClick:o,className:"flex items-center gap-2 px-3 py-2 rounded-xl bg-card border border-border hover:bg-muted transition-colors text-sm",children:[e.jsx(A,{className:"w-4 h-4"}),"Refresh"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"lg:col-span-2 bg-card border border-border rounded-xl p-3",children:[e.jsx("div",{className:"text-xs font-semibold text-foreground mb-2",children:"Search"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("input",{value:l,onChange:t=>j(t.target.value),placeholder:"Title / details / site...",className:"w-full bg-transparent outline-none text-sm text-foreground placeholder:text-muted-foreground"})]})]}),e.jsxs("div",{className:"bg-card border border-border rounded-xl p-3",children:[e.jsx("div",{className:"text-xs font-semibold text-foreground mb-2",children:"Status"}),e.jsx("div",{className:"flex gap-1",children:["all","done","cancelled"].map(t=>e.jsx("button",{onClick:()=>b(t),className:`px-2.5 py-1 rounded-lg text-xs font-medium transition-colors border ${d===t?"bg-muted text-foreground border-border":"text-muted-foreground hover:text-foreground border-transparent"}`,children:t==="all"?"All":t==="done"?"Done":"Cancelled"},t))})]}),e.jsxs("div",{className:"bg-card border border-border rounded-xl p-3",children:[e.jsx("div",{className:"text-xs font-semibold text-foreground mb-2",children:"From"}),e.jsx("input",{type:"date",value:u,onChange:t=>N(t.target.value),className:"w-full bg-transparent outline-none text-sm text-foreground"}),e.jsx("div",{className:"mt-2",children:e.jsx("button",{onClick:o,className:"w-full px-3 py-2 rounded-xl bg-primary text-primary-foreground text-sm font-semibold hover:opacity-90 transition",children:"Apply"})})]})]}),e.jsxs("div",{className:"bg-card border border-border rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-border",children:[e.jsxs("div",{className:"text-sm font-semibold text-foreground",children:[n.length," item",n.length!==1?"s":""]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Today: ",i(C())]})]}),h?e.jsx("div",{className:"p-6 text-sm text-muted-foreground",children:"Loading…"}):n.length===0?e.jsx("div",{className:"p-8 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-muted-foreground",children:[e.jsx(f,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm",children:"No archived items found"})]})}):e.jsx("div",{className:"max-h-[560px] overflow-y-auto",children:n.map(t=>{const s=t.status==="done",a=s?t.completed_at:t.cancelled_at;return e.jsx("button",{onClick:()=>w(t),className:"w-full text-left px-4 py-3 border-b border-border hover:bg-muted/40 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm font-medium text-foreground truncate",children:t.title||"Unnamed"}),e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded border ${s?"border-success/30 bg-success/10 text-success":"border-danger/30 bg-danger/10 text-danger"}`,children:s?"Done":"Cancelled"}),t.priority&&e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded border border-border bg-muted text-muted-foreground",children:t.priority}),t.category&&e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded border border-border bg-muted text-muted-foreground",children:t.category})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-1 text-xs text-muted-foreground",children:[e.jsx("span",{className:"truncate",children:t.site_name||"—"}),t.due_date&&e.jsxs("span",{children:["Due: ",i(t.due_date)]}),a&&e.jsxs("span",{children:[s?"Completed":"Cancelled",": ",i(a)]})]}),t.details&&e.jsx("div",{className:"mt-1 text-xs text-muted-foreground truncate",children:t.details})]}),e.jsx("div",{className:"pt-1",children:s?e.jsx(f,{className:"w-4 h-4 text-success"}):e.jsx(F,{className:"w-4 h-4 text-danger"})})]})},t.id)})})]}),e.jsx($,{open:v,item:y,onClose:_,onChanged:async()=>{await o()}})]})};export{B as default};
