import{r as s,j as e}from"./vendor-Coh6w-wA.js";import{s as W}from"./index-CFnRQUVA.js";import"./radix-wrHiDKbY.js";import"./icons-BlIjFQrJ.js";import"./tanstack-x3w5gpW7.js";import"./supabase-jRWW_51U.js";import"./router-jL34xOpu.js";const u=6,b=18,_=n=>n.toISOString().slice(0,10);function G(n){if(!n)return"";const a=String(n);return a.length>=5?a.slice(0,5):a}function J(n){const a=(n||"").trim();return a?(a.length===5,a):null}const ie=()=>{const n=new Date,[a,f]=s.useState("month"),[l,K]=s.useState(new Date(n.getFullYear(),n.getMonth(),1)),[o,y]=s.useState(n),[j,Q]=s.useState([]),[x,N]=s.useState(null),[V,C]=s.useState(!0),[X,v]=s.useState(!1),[p,k]=s.useState(!1),[T,h]=s.useState(null),[E,M]=s.useState(""),[I,F]=s.useState(""),[O,Y]=s.useState(""),[A,R]=s.useState(""),[U,z]=s.useState(""),L=async()=>{C(!0);const{data:t,error:r}=await W.from("action_items").select("*").is("deleted_at",null);!r&&t&&Q(t),C(!1)};s.useEffect(()=>{L()},[]);const Z=l.toLocaleString("default",{month:"long",year:"numeric"}),P=t=>{K(new Date(l.getFullYear(),l.getMonth()+t,1))},g=s.useMemo(()=>{const t=_(o);return j.filter(r=>r.due_date===t)},[j,o]),B=s.useMemo(()=>g.filter(t=>!t.start_time&&!t.end_time),[g]),$=s.useMemo(()=>g.filter(t=>!!t.start_time||!!t.end_time),[g]),H=t=>{N(t),h(null),M(String(t.title||"")),F(String(t.details||"")),Y(String(t.due_date||_(o))),R(G(t.start_time)),z(G(t.end_time)),v(!0)},q=()=>{p||(v(!1),N(null),h(null))},ee=async()=>{if(x!=null&&x.id){k(!0),h(null);try{const t={title:(E||"").trim()||null,details:(I||"").trim()||null,due_date:(O||"").trim()||null,start_time:J(A),end_time:J(U)},{error:r}=await W.from("action_items").update(t).eq("id",x.id);if(r)throw r;await L(),v(!1),N(null)}catch(t){h((t==null?void 0:t.message)||"Save failed")}finally{k(!1)}}};return V?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-primary"})}):e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>f("month"),className:"px-3 py-1 border rounded "+(a==="month"?"bg-primary text-primary-foreground":""),children:"Month"}),e.jsx("button",{onClick:()=>f("day"),className:"px-3 py-1 border rounded "+(a==="day"?"bg-primary text-primary-foreground":""),children:"Day"})]}),a==="month"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("button",{onClick:()=>P(-1),className:"px-3 py-1 border rounded",children:"?"}),e.jsx("div",{className:"text-lg font-semibold",children:Z}),e.jsx("button",{onClick:()=>P(1),className:"px-3 py-1 border rounded",children:"?"})]}),e.jsx("div",{className:"grid grid-cols-7 gap-2 text-sm text-center text-muted-foreground",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(t=>e.jsx("div",{children:t},t))}),e.jsx("div",{className:"grid grid-cols-7 gap-2",children:Array.from({length:42}).map((t,r)=>{const S=new Date(l.getFullYear(),l.getMonth(),1).getDay(),i=r-S+1,w=new Date(l.getFullYear(),l.getMonth()+1,0).getDate();if(i<1||i>w)return e.jsx("div",{className:"h-24 border rounded bg-muted/20"},r);const c=new Date(l.getFullYear(),l.getMonth(),i),D=_(c),m=j.filter(te=>te.due_date===D).length;return e.jsxs("div",{onClick:()=>{y(c),f("day")},className:"h-24 border rounded p-1 cursor-pointer hover:bg-muted/40",children:[e.jsx("div",{className:"text-xs",children:i}),m>0&&e.jsxs("div",{className:"mt-1 text-xs bg-primary/20 px-1 rounded",children:[m," item",m>1?"s":""]})]},r)})})]}),a==="day"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("button",{onClick:()=>y(new Date(o.getTime()-864e5)),className:"px-3 py-1 border rounded",children:"?"}),e.jsx("div",{className:"font-semibold",children:o.toDateString()}),e.jsx("button",{onClick:()=>y(new Date(o.getTime()+864e5)),className:"px-3 py-1 border rounded",children:"?"})]}),B.length>0&&e.jsxs("div",{className:"border rounded p-3 space-y-2",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Agenda (no time)"}),B.map(t=>e.jsx("button",{onClick:()=>H(t),className:"w-full text-left px-3 py-2 rounded border hover:bg-muted/40",children:t.title||"Untitled"},t.id))]}),e.jsxs("div",{className:"relative border rounded h-[600px] overflow-hidden",children:[Array.from({length:b-u+1}).map((t,r)=>{const d=u+r;return e.jsx("div",{className:"absolute left-0 right-0 border-t text-xs text-muted-foreground",style:{top:r/(b-u)*100+"%"},children:e.jsxs("span",{className:"absolute -left-12",children:[d,":00"]})},d)}),$.map((t,r)=>{const d=t.start_time?parseInt(String(t.start_time).split(":")[0]):8,S=t.end_time?parseInt(String(t.end_time).split(":")[0]):d+2,i=(d-u)/(b-u)*100,w=(S-d)/(b-u)*100,c=r%3,D=64+c*10,m=16+(2-c)*10;return e.jsx("div",{onClick:()=>H(t),className:"absolute rounded p-2 text-xs bg-primary/20 border border-primary cursor-pointer hover:bg-primary/30 overflow-hidden",style:{top:i+"%",height:Math.max(w,6)+"%",left:D+"px",right:m+"px",zIndex:10+c},children:e.jsx("div",{className:"font-medium leading-4 truncate",children:t.title||"Untitled"})},t.id)})]})]}),X&&e.jsxs("div",{className:"fixed inset-0 z-50",children:[e.jsx("button",{type:"button","aria-label":"Close",className:"absolute inset-0 bg-black/60",onClick:q}),e.jsx("div",{className:"absolute inset-x-0 top-10 mx-auto w-[95%] max-w-xl",children:e.jsxs("div",{className:"bg-card border border-border rounded-2xl shadow-xl overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-border",children:[e.jsx("div",{className:"text-base font-semibold",children:"Edit Item"}),T&&e.jsx("div",{className:"mt-2 text-sm text-danger",children:T})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"Title"}),e.jsx("input",{className:"w-full px-3 py-2 border rounded bg-background",value:E,onChange:t=>M(t.target.value),placeholder:"Title"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"Details"}),e.jsx("textarea",{className:"w-full px-3 py-2 border rounded bg-background min-h-[90px]",value:I,onChange:t=>F(t.target.value),placeholder:"Details"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"Due date"}),e.jsx("input",{type:"date",className:"w-full px-3 py-2 border rounded bg-background",value:O,onChange:t=>Y(t.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"Start"}),e.jsx("input",{type:"time",className:"w-full px-3 py-2 border rounded bg-background",value:A,onChange:t=>R(t.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"End"}),e.jsx("input",{type:"time",className:"w-full px-3 py-2 border rounded bg-background",value:U,onChange:t=>z(t.target.value)})]})]})]}),e.jsxs("div",{className:"p-4 border-t border-border flex justify-end gap-2",children:[e.jsx("button",{className:"px-3 py-2 border rounded",onClick:q,disabled:p,children:"Cancel"}),e.jsx("button",{className:"px-3 py-2 rounded bg-primary text-primary-foreground",onClick:ee,disabled:p,children:p?"Saving...":"Save"})]})]})})]})]})};export{ie as default};
