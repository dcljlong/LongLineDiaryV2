import{r as n,j as e}from"./vendor-PYixsk0d.js";import{f as $,a as M,t as y,b as H,c as N,d as v,g as B}from"./index-D0t-FdKY.js";import{P as _}from"./PriorityBadge-BOTd3lE0.js";import{B as F,T as W,b as z,t as p,m as J,C as O,P as R,A as b,W as w,u as k,k as V,v as G,w as K,H as Q,x as X}from"./icons-DUP5S1G1.js";import"./radix-D8qNXTYQ.js";import"./tanstack-C9VkMA4e.js";import"./supabase-BGS_MQFj.js";import"./router-DIvsDq8X.js";const le=({onNavigate:c,onQuickAdd:g})=>{const[h,C]=n.useState([]),[x,P]=n.useState([]),[m,A]=n.useState(null),[l,D]=n.useState(null),[u,I]=n.useState("all"),[q,j]=n.useState(!0);n.useEffect(()=>{L()},[]);const L=async()=>{j(!0);try{const[r,t,o]=await Promise.all([$(),M({date:y()}),H()]);C(r),P(t),A(s),D(o)}catch(r){console.error(r)}j(!1)},f=n.useMemo(()=>{if(!l)return[];const r=[];return l.activities.forEach(t=>{var o,a,i,d;return r.push({...t,_type:"activity",_dueDate:t.due_date,_project:((a=(o=t.daily_logs)==null?void 0:o.projects)==null?void 0:a.name)||"Unknown",_jobNumber:((d=(i=t.daily_logs)==null?void 0:i.projects)==null?void 0:d.job_number)||""})}),l.materials.forEach(t=>{var o,a,i,d;return r.push({...t,_type:"material",_dueDate:t.required_date,_project:((a=(o=t.daily_logs)==null?void 0:o.projects)==null?void 0:a.name)||"Unknown",_jobNumber:((d=(i=t.daily_logs)==null?void 0:i.projects)==null?void 0:d.job_number)||""})}),l.equipment.forEach(t=>{var o,a,i,d;return r.push({...t,_type:"equipment",_dueDate:t.due_date,_project:((a=(o=t.daily_logs)==null?void 0:o.projects)==null?void 0:a.name)||"Unknown",_jobNumber:((d=(i=t.daily_logs)==null?void 0:i.projects)==null?void 0:d.job_number)||""})}),l.crew.forEach(t=>{var o,a,i,d;return r.push({...t,_type:"crew",_dueDate:t.due_date,_project:((a=(o=t.daily_logs)==null?void 0:o.projects)==null?void 0:a.name)||"Unknown",_jobNumber:((d=(i=t.daily_logs)==null?void 0:i.projects)==null?void 0:d.job_number)||""})}),r.map(t=>({...t,_priority:N(t._dueDate)})).filter(t=>u==="all"||t._priority===u).sort((t,o)=>{const a={high:0,medium:1,low:2};return a[t._priority]-a[o._priority]})},[l,u]),E=m?[{label:"Active Projects",value:m.activeProjects,icon:F,color:"from-blue-500 to-blue-600",textColor:"text-blue-400"},{label:"High Priority",value:m.highPriorityLogs,icon:W,color:"from-red-500 to-red-600",textColor:"text-danger"},{label:"Overdue Items",value:m.totalOverdue,icon:z,color:"from-primary to-primary",textColor:"text-primary"},{label:"Pending Materials",value:m.pendingMaterials,icon:p,color:"from-purple-500 to-purple-600",textColor:"text-purple-400"},{label:"Safety Incidents",value:m.safetyIncidents,icon:J,color:"from-emerald-500 to-emerald-600",textColor:"text-emerald-400"},{label:"Total Logs",value:m.totalLogs,icon:O,color:"from-indigo-500 to-indigo-600",textColor:"text-indigo-400"}]:[],S=[{label:"Work Activity",icon:b,color:"bg-blue-500/20 text-blue-600 border-blue-500/30",action:()=>c("daily-logs",{tab:"activities"})},{label:"Materials",icon:p,color:"bg-purple-500/20 text-purple-600 border-purple-500/30",action:()=>c("daily-logs",{tab:"materials"})},{label:"Equipment",icon:w,color:"bg-primary/20 text-primary border-primary/30",action:()=>c("daily-logs",{tab:"equipment"})},{label:"Crew",icon:k,color:"bg-emerald-500/20 text-emerald-600 border-emerald-500/30",action:()=>c("daily-logs",{tab:"crew"})},{label:"Visitor",icon:V,color:"bg-indigo-500/20 text-indigo-600 border-indigo-500/30",action:()=>c("daily-logs",{tab:"visitors"})},{label:"Delivery",icon:G,color:"bg-rose-500/20 text-rose-600 border-rose-500/30",action:()=>c("calendar",{type:"delivery"})}],U={activity:b,material:p,equipment:w,crew:k},T={activity:"Activity",material:"Material",equipment:"Equipment",crew:"Crew"};return q?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Command Center"}),e.jsxs("p",{className:"text-muted-foreground text-sm mt-1",children:[v(y())," â€” ",x.length," job",x.length!==1?"s":""," logged today"]})]}),e.jsxs("button",{onClick:g,className:"flex items-center gap-2 px-4 py-2.5 rounded-lg bg-primary hover:bg-primary/90 text-primary-foreground font-semibold text-sm transition-colors",children:[e.jsx(R,{className:"w-4 h-4"}),"New Job"]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3",children:E.map((r,t)=>{const o=r.icon;return e.jsxs("div",{className:"bg-card border border-border rounded-xl p-4 hover:border-border/50 transition-colors",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx("div",{className:`w-8 h-8 rounded-lg bg-gradient-to-br ${r.color} flex items-center justify-center`,children:e.jsx(o,{className:"w-4 h-4 text-foreground"})})}),e.jsx("div",{className:"text-2xl font-bold text-foreground",children:r.value}),e.jsx("div",{className:"text-xs text-muted-foreground mt-0.5",children:r.label})]},t)})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-semibold text-foreground uppercase tracking-wider mb-3",children:"Quick Add"}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-6 gap-2",children:S.map((r,t)=>{const o=r.icon;return e.jsxs("button",{onClick:r.action,className:`flex flex-col items-center gap-2 p-3 rounded-xl border ${r.color} hover:scale-105 transition-transform`,children:[e.jsx(o,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs font-medium",children:r.label})]},t)})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-sm font-semibold text-foreground uppercase tracking-wider",children:"Active Projects"}),e.jsxs("button",{onClick:()=>c("daily-logs"),className:"text-xs text-primary hover:text-primary/90 flex items-center gap-1",children:["View All ",e.jsx(K,{className:"w-3 h-3"})]})]}),e.jsx("div",{className:"space-y-2 max-h-[500px] overflow-y-auto pr-1",children:h.filter(r=>r.status==="active").length===0?e.jsxs("div",{className:"bg-card border border-border rounded-xl p-6 text-center",children:[e.jsx(Q,{className:"w-8 h-8 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No active projects"}),e.jsx("button",{onClick:g,className:"mt-2 text-xs text-primary hover:text-primary/90",children:"Create your first job"})]}):h.filter(r=>r.status==="active").map(r=>{const t=x.filter(o=>o.project_id===r.id);return e.jsx("button",{onClick:()=>c("daily-logs",{project_id:r.id}),className:"w-full text-left bg-card border border-border rounded-xl p-4 hover:border-primary/30 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"text-xs font-mono text-primary bg-primary/10 px-1.5 py-0.5 rounded",children:r.job_number||"#"})}),e.jsx("h3",{className:"text-sm font-semibold text-foreground mt-1 truncate",children:r.name}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:r.location||r.client||"No location"})]}),e.jsx("div",{className:"flex flex-col items-end gap-1 ml-2",children:t.length>0&&e.jsx("span",{className:"text-[10px] bg-emerald-500/10 text-emerald-400 px-1.5 py-0.5 rounded-full border border-emerald-500/20",children:"Logged today"})})]})},r.id)})})]}),e.jsxs("div",{className:"lg:col-span-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-sm font-semibold text-foreground uppercase tracking-wider",children:"Priority Items"}),e.jsx("div",{className:"flex gap-1",children:["all","high","medium","low"].map(r=>e.jsxs("button",{onClick:()=>I(r),className:`px-2.5 py-1 rounded-lg text-xs font-medium transition-colors ${u===r?r==="high"?"bg-danger/15 text-danger border border-danger/30":r==="medium"?"bg-primary/20 text-primary border border-primary/30":r==="low"?"bg-success/15 text-success border border-success/30":"bg-muted text-foreground border border-border":"text-muted-foreground hover:text-foreground border border-transparent"}`,children:[r==="all"?"All":r.charAt(0).toUpperCase()+r.slice(1),r!=="all"&&l&&e.jsxs("span",{className:"ml-1",children:["(",[...l.activities,...l.materials,...l.equipment,...l.crew].filter(t=>N(t.due_date||t.required_date)===r).length,")"]})]},r))})]}),e.jsx("div",{className:"space-y-2 max-h-[500px] overflow-y-auto pr-1",children:f.length===0?e.jsxs("div",{className:"bg-card border border-border rounded-xl p-8 text-center",children:[e.jsx(X,{className:"w-10 h-10 text-success mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-foreground font-medium",children:"All clear!"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"No outstanding items to show"})]}):f.slice(0,20).map((r,t)=>{const o=U[r._type]||b;return e.jsx("div",{className:"bg-card border border-border rounded-xl p-3 hover:border-border/50 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-2 h-2 rounded-full mt-2 flex-shrink-0 ${B(r._priority)}`}),e.jsx(o,{className:"w-4 h-4 text-muted-foreground mt-1 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm font-medium text-foreground truncate",children:r.description||r.equipment_name||r.worker_name||"Unnamed"}),e.jsx(_,{priority:r._priority,size:"sm",showIcon:!1}),e.jsx("span",{className:"text-[10px] text-muted-foreground bg-muted px-1.5 py-0.5 rounded",children:T[r._type]})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-1 text-xs text-muted-foreground",children:[e.jsx("span",{children:r._project}),r._jobNumber&&e.jsxs("span",{className:"font-mono text-primary/60",children:["#",r._jobNumber]}),r._dueDate&&e.jsxs("span",{children:["Due: ",v(r._dueDate)]})]}),r.notes&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1 truncate",children:r.notes})]})]})},`${r._type}-${r.id}-${t}`)})})]})]}),x.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-semibold text-foreground uppercase tracking-wider mb-3",children:"Today's Jobs"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:x.map(r=>{var t,o;return e.jsxs("button",{onClick:()=>c("daily-logs",{logId:r.id}),className:"text-left bg-card border border-border rounded-xl p-4 hover:border-primary/30 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs font-mono text-primary bg-primary/10 px-1.5 py-0.5 rounded",children:((t=r.project)==null?void 0:t.job_number)||"#"}),e.jsx(_,{priority:r.priority,size:"sm"})]}),e.jsx("h3",{className:"text-sm font-semibold text-foreground",children:((o=r.project)==null?void 0:o.name)||"Unknown Project"}),e.jsxs("div",{className:"flex items-center gap-3 mt-2 text-xs text-muted-foreground",children:[r.weather&&e.jsx("span",{children:r.weather}),r.temperature&&e.jsx("span",{children:r.temperature})]}),r.critical_items&&e.jsx("div",{className:"mt-2 p-2 rounded-lg bg-danger/10 border border-danger/20",children:e.jsx("p",{className:"text-xs text-danger line-clamp-2",children:r.critical_items})})]},r.id)})})]})]})};export{le as default};
