import{r as o,j as e,H as q,C as b,J as B,K as H,D as K}from"./vendor-BoONKYJD.js";import{t as U,i as Q,N as C,C as V,a as W,f as X,D as Z,E as ee,F as se}from"./index-B9PDxaeQ.js";import{P as _}from"./PriorityBadge-gvIaZXMM.js";import{P as te,g as re,f as ae,G as oe,N as le,O as de,Q as ne,x as ie,V as k,K as ce,a as me,X as xe}from"./icons-CIwE7be1.js";import"./radix-CabrV1M5.js";import"./tanstack-B2M40KIA.js";import"./supabase-DccELjI_.js";import"./router-Bh4LCQDV.js";const m="lld-input w-full px-3 py-2 rounded-lg text-sm",x="block text-xs font-medium text-muted-foreground mb-1",we=({onNavigate:S,initialData:ue})=>{const[l,j]=o.useState(new Date),[u,f]=o.useState(U()),[M,D]=o.useState([]),[T,P]=o.useState([]),[E,I]=o.useState([]),[L,d]=o.useState(!1),[pe,N]=o.useState(!0),[t,n]=o.useState({title:"",description:"",note_type:"note",priority:"low",project_id:""}),p=async()=>{N(!0);try{const[s,a,r]=await Promise.all([V(l.getMonth(),l.getFullYear()),W(),X()]);D(s),P(a),I(r)}catch(s){console.error(s)}N(!1)};o.useEffect(()=>{p()},[l]);const A=Q(l.getFullYear(),l.getMonth()),y=s=>{const a=T.filter(c=>c.log_date===s),r=M.filter(c=>c.note_date===s);return{logs:a,notes:r}},i=y(u),$=async()=>{try{await se({...t,note_date:u,project_id:t.project_id||null,is_completed:!1}),n({title:"",description:"",note_type:"note",priority:"low",project_id:""}),d(!1),p()}catch(s){console.error(s)}},F=async(s,a)=>{await Z(s,{is_completed:a}),p()},z=async s=>{await ee(s),p()},O={note:k,reminder:ie,meeting:ne,deadline:de,inspection:le,delivery:oe},R={note:"bg-blue-500",reminder:"bg-purple-500",meeting:"bg-indigo-500",deadline:"bg-red-500",inspection:"bg-primary",delivery:"bg-green-500"};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Calendar"}),e.jsxs("button",{onClick:()=>d(!0),className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-primary hover:bg-primary/90 text-primary-foreground text-sm font-semibold transition-colors",children:[e.jsx(te,{className:"w-4 h-4"}),"Add Note"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 bg-card border border-border rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:()=>j(q(l)),className:"p-2 rounded-lg hover:bg-muted text-muted-foreground",children:e.jsx(re,{className:"w-5 h-5"})}),e.jsx("h2",{className:"text-lg font-bold text-foreground",children:b(l,"MMMM yyyy")}),e.jsx("button",{onClick:()=>j(B(l,1)),className:"p-2 rounded-lg hover:bg-muted text-muted-foreground",children:e.jsx(ae,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"grid grid-cols-7 gap-1 mb-1",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(s=>e.jsx("div",{className:"text-center text-xs font-medium text-muted-foreground py-2",children:s},s))}),A.map((s,a)=>e.jsx("div",{className:"grid grid-cols-7 gap-1",children:s.map((r,c)=>{if(!r)return e.jsx("div",{className:"aspect-square"},c);const h=b(r,"yyyy-MM-dd"),v=h===u,w=H(r,new Date),g=y(h),G=g.logs.length>0;return g.notes.length>0,e.jsxs("button",{onClick:()=>f(h),className:`aspect-square p-1 rounded-lg flex flex-col items-start transition-colors relative ${v?"bg-primary/20 border-2 border-primary/50":w?"bg-muted/70 border border-border":"hover:bg-muted/30 border border-transparent"}`,children:[e.jsx("span",{className:`text-xs font-medium ${v?"text-primary":"text-foreground"}`,children:r.getDate()}),e.jsxs("div",{className:"flex gap-0.5 mt-auto flex-wrap",children:[G&&e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-primary"}),g.notes.slice(0,3).map((J,Y)=>e.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${R[J.note_type]||"bg-blue-500"}`},Y))]})]},c)})},a)),e.jsxs("div",{className:"flex flex-wrap gap-3 mt-4 pt-3 border-t border-border",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-primary"})," Jobs"]}),C.map(s=>e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${s.color}`})," ",s.label]},s.value))]})]}),e.jsxs("div",{className:"bg-card border border-border rounded-xl p-4 overflow-y-auto max-h-[700px]",children:[e.jsx("h3",{className:"text-sm font-bold text-foreground mb-3",children:b(K(u),"EEEE, dd MMMM yyyy")}),i.logs.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-xs font-semibold text-foreground/80 uppercase mb-2",children:"Jobs"}),e.jsx("div",{className:"space-y-2",children:i.logs.map(s=>{var a,r;return e.jsxs("button",{onClick:()=>S("daily-logs",{logId:s.id}),className:"w-full text-left p-3 rounded-lg bg-primary/10 border border-amber-500/20 hover:border-amber-500/40 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs font-mono text-primary",children:["#",((a=s.project)==null?void 0:a.job_number)||"â€”"]}),e.jsx(_,{priority:s.priority,size:"sm",showIcon:!1})]}),e.jsx("p",{className:"text-sm font-medium text-foreground mt-1",children:((r=s.project)==null?void 0:r.name)||"Unknown"}),s.weather&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[s.weather," ",s.temperature]})]},s.id)})})]}),i.notes.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-xs font-semibold text-foreground/80 uppercase mb-2",children:"Notes & Reminders"}),e.jsx("div",{className:"space-y-2",children:i.notes.map(s=>{const a=O[s.note_type]||k;return e.jsx("div",{className:`p-3 rounded-lg border transition-colors ${s.is_completed?"bg-card/30 border-border opacity-60":"bg-muted/60 border-border"}`,children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("input",{type:"checkbox",checked:s.is_completed,onChange:r=>F(s.id,r.target.checked),className:"w-4 h-4 mt-0.5 rounded border-border bg-muted text-amber-500"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(a,{className:"w-3.5 h-3.5 text-muted-foreground"}),e.jsx("span",{className:`text-sm font-medium ${s.is_completed?"line-through text-muted-foreground":"text-foreground"}`,children:s.title})]}),s.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.description}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(_,{priority:s.priority,size:"sm",showIcon:!1}),e.jsx("span",{className:"text-[10px] text-muted-foreground capitalize",children:s.note_type})]})]}),e.jsx("button",{onClick:()=>z(s.id),className:"p-1 rounded hover:bg-red-500/20 text-red-400",children:e.jsx(ce,{className:"w-3.5 h-3.5"})})]})},s.id)})})]}),i.logs.length===0&&i.notes.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(me,{className:"w-8 h-8 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Nothing scheduled"}),e.jsx("button",{onClick:()=>d(!0),className:"mt-2 text-xs text-primary hover:text-primary/90",children:"Add a note or reminder"})]})]})]}),L&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",onClick:()=>d(!1),children:e.jsxs("div",{className:"bg-card border border-border rounded-2xl w-full max-w-md shadow-2xl",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[e.jsx("h2",{className:"text-lg font-bold text-foreground",children:"Add Note"}),e.jsx("button",{onClick:()=>d(!1),className:"p-1 rounded-lg hover:bg-muted text-muted-foreground",children:e.jsx(xe,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:x,children:"Date"}),e.jsx("input",{type:"date",value:u,onChange:s=>f(s.target.value),className:m})]}),e.jsxs("div",{children:[e.jsx("label",{className:x,children:"Title *"}),e.jsx("input",{value:t.title,onChange:s=>n({...t,title:s.target.value}),className:m,placeholder:"e.g. Order plasterboard"})]}),e.jsxs("div",{children:[e.jsx("label",{className:x,children:"Description"}),e.jsx("textarea",{value:t.description,onChange:s=>n({...t,description:s.target.value}),rows:2,className:`${m} resize-none`})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:x,children:"Type"}),e.jsx("select",{value:t.note_type,onChange:s=>n({...t,note_type:s.target.value}),className:m,children:C.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:x,children:"Priority"}),e.jsxs("select",{value:t.priority,onChange:s=>n({...t,priority:s.target.value}),className:m,children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:x,children:"Link to Project (optional)"}),e.jsxs("select",{value:t.project_id,onChange:s=>n({...t,project_id:s.target.value}),className:m,children:[e.jsx("option",{value:"",children:"None (General)"}),E.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{onClick:()=>d(!1),className:"flex-1 py-2.5 rounded-lg bg-muted text-foreground hover:bg-muted/80 text-sm font-medium",children:"Cancel"}),e.jsx("button",{onClick:$,disabled:!t.title.trim(),className:"flex-1 py-2.5 rounded-lg bg-primary hover:bg-primary/90 text-primary-foreground text-sm font-bold disabled:opacity-50",children:"Add Note"})]})]})]})})]})};export{we as default};
