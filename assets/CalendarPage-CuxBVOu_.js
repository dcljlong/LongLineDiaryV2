import{r as l,j as e,H as q,C as b,J as B,K as H,D as K}from"./vendor-BUGsBopJ.js";import{t as U,i as Q,N as C,C as V,a as W,f as X,D as Z,E as ee,F as se}from"./index-C9T-8GFa.js";import{P as _}from"./PriorityBadge-B6ufke2k.js";import{P as te,g as ae,f as re,G as le,N as oe,O as de,Q as ne,x as ie,V as k,K as ce,a as me,X as xe}from"./icons-BH71IJCZ.js";import"./radix-DOd9NWOq.js";import"./tanstack-D2p4VxNq.js";import"./router-DTOaVcvx.js";import"./supabase-BqdusSG3.js";const m="lld-input w-full px-3 py-2 rounded-lg text-sm",x="block text-xs font-medium text-muted-foreground mb-1",we=({onNavigate:S,initialData:pe})=>{const[o,j]=l.useState(new Date),[p,N]=l.useState(U()),[M,D]=l.useState([]),[T,P]=l.useState([]),[E,I]=l.useState([]),[L,d]=l.useState(!1),[he,f]=l.useState(!0),[t,n]=l.useState({title:"",description:"",note_type:"note",priority:"low",project_id:""}),h=async()=>{f(!0);try{const[s,r,a]=await Promise.all([V(o.getMonth(),o.getFullYear()),W(),X()]);D(s),P(r),I(a)}catch(s){console.error(s)}f(!1)};l.useEffect(()=>{h()},[o]);const A=Q(o.getFullYear(),o.getMonth()),y=s=>{const r=T.filter(c=>c.log_date===s),a=M.filter(c=>c.note_date===s);return{logs:r,notes:a}},i=y(p),$=async()=>{try{await se({...t,note_date:p,project_id:t.project_id||null,is_completed:!1}),n({title:"",description:"",note_type:"note",priority:"low",project_id:""}),d(!1),h()}catch(s){console.error(s)}},F=async(s,r)=>{await Z(s,{is_completed:r}),h()},z=async s=>{await ee(s),h()},O={note:k,reminder:ie,meeting:ne,deadline:de,inspection:oe,delivery:le},R={note:"bg-blue-500",reminder:"bg-purple-500",meeting:"bg-indigo-500",deadline:"bg-red-500",inspection:"bg-primary",delivery:"bg-green-500"};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Calendar"}),e.jsxs("button",{onClick:()=>d(!0),className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-primary hover:bg-primary/90 text-primary-foreground text-sm font-semibold transition-colors",children:[e.jsx(te,{className:"w-4 h-4"}),"Add Note"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 bg-card border border-border rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:()=>j(q(o)),className:"p-2 rounded-lg hover:bg-slate-700 text-muted-foreground",children:e.jsx(ae,{className:"w-5 h-5"})}),e.jsx("h2",{className:"text-lg font-bold text-white",children:b(o,"MMMM yyyy")}),e.jsx("button",{onClick:()=>j(B(o,1)),className:"p-2 rounded-lg hover:bg-slate-700 text-muted-foreground",children:e.jsx(re,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"grid grid-cols-7 gap-1 mb-1",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(s=>e.jsx("div",{className:"text-center text-xs font-medium text-muted-foreground py-2",children:s},s))}),A.map((s,r)=>e.jsx("div",{className:"grid grid-cols-7 gap-1",children:s.map((a,c)=>{if(!a)return e.jsx("div",{className:"aspect-square"},c);const u=b(a,"yyyy-MM-dd"),v=u===p,w=H(a,new Date),g=y(u),G=g.logs.length>0;return g.notes.length>0,e.jsxs("button",{onClick:()=>N(u),className:`aspect-square p-1 rounded-lg flex flex-col items-start transition-colors relative ${v?"bg-primary/20 border-2 border-primary/50":w?"bg-slate-700/50 border border-slate-600":"hover:bg-slate-700/30 border border-transparent"}`,children:[e.jsx("span",{className:`text-xs font-medium ${v?"text-primary":w?"text-white":"text-foreground"}`,children:a.getDate()}),e.jsxs("div",{className:"flex gap-0.5 mt-auto flex-wrap",children:[G&&e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-primary"}),g.notes.slice(0,3).map((J,Y)=>e.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${R[J.note_type]||"bg-blue-500"}`},Y))]})]},c)})},r)),e.jsxs("div",{className:"flex flex-wrap gap-3 mt-4 pt-3 border-t border-border",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-primary"})," Jobs"]}),C.map(s=>e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${s.color}`})," ",s.label]},s.value))]})]}),e.jsxs("div",{className:"bg-card border border-border rounded-xl p-4 overflow-y-auto max-h-[700px]",children:[e.jsx("h3",{className:"text-sm font-bold text-white mb-3",children:b(K(p),"EEEE, dd MMMM yyyy")}),i.logs.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-xs font-semibold text-muted-foreground uppercase mb-2",children:"Jobs"}),e.jsx("div",{className:"space-y-2",children:i.logs.map(s=>{var r,a;return e.jsxs("button",{onClick:()=>S("daily-logs",{logId:s.id}),className:"w-full text-left p-3 rounded-lg bg-primary/10 border border-amber-500/20 hover:border-amber-500/40 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs font-mono text-primary",children:["#",((r=s.project)==null?void 0:r.job_number)||"â€”"]}),e.jsx(_,{priority:s.priority,size:"sm",showIcon:!1})]}),e.jsx("p",{className:"text-sm font-medium text-white mt-1",children:((a=s.project)==null?void 0:a.name)||"Unknown"}),s.weather&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[s.weather," ",s.temperature]})]},s.id)})})]}),i.notes.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-xs font-semibold text-muted-foreground uppercase mb-2",children:"Notes & Reminders"}),e.jsx("div",{className:"space-y-2",children:i.notes.map(s=>{const r=O[s.note_type]||k;return e.jsx("div",{className:`p-3 rounded-lg border transition-colors ${s.is_completed?"bg-card/30 border-border opacity-60":"bg-slate-700/30 border-slate-600/50"}`,children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("input",{type:"checkbox",checked:s.is_completed,onChange:a=>F(s.id,a.target.checked),className:"w-4 h-4 mt-0.5 rounded border-slate-500 bg-slate-700 text-amber-500"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(r,{className:"w-3.5 h-3.5 text-muted-foreground"}),e.jsx("span",{className:`text-sm font-medium ${s.is_completed?"line-through text-muted-foreground":"text-white"}`,children:s.title})]}),s.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.description}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(_,{priority:s.priority,size:"sm",showIcon:!1}),e.jsx("span",{className:"text-[10px] text-muted-foreground capitalize",children:s.note_type})]})]}),e.jsx("button",{onClick:()=>z(s.id),className:"p-1 rounded hover:bg-red-500/20 text-red-400",children:e.jsx(ce,{className:"w-3.5 h-3.5"})})]})},s.id)})})]}),i.logs.length===0&&i.notes.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(me,{className:"w-8 h-8 text-slate-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Nothing scheduled"}),e.jsx("button",{onClick:()=>d(!0),className:"mt-2 text-xs text-primary hover:text-primary/90",children:"Add a note or reminder"})]})]})]}),L&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",onClick:()=>d(!1),children:e.jsxs("div",{className:"bg-card border border-slate-700 rounded-2xl w-full max-w-md shadow-2xl",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-700",children:[e.jsx("h2",{className:"text-lg font-bold text-white",children:"Add Note"}),e.jsx("button",{onClick:()=>d(!1),className:"p-1 rounded-lg hover:bg-slate-700 text-muted-foreground",children:e.jsx(xe,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:x,children:"Date"}),e.jsx("input",{type:"date",value:p,onChange:s=>N(s.target.value),className:m})]}),e.jsxs("div",{children:[e.jsx("label",{className:x,children:"Title *"}),e.jsx("input",{value:t.title,onChange:s=>n({...t,title:s.target.value}),className:m,placeholder:"e.g. Order plasterboard"})]}),e.jsxs("div",{children:[e.jsx("label",{className:x,children:"Description"}),e.jsx("textarea",{value:t.description,onChange:s=>n({...t,description:s.target.value}),rows:2,className:`${m} resize-none`})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:x,children:"Type"}),e.jsx("select",{value:t.note_type,onChange:s=>n({...t,note_type:s.target.value}),className:m,children:C.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:x,children:"Priority"}),e.jsxs("select",{value:t.priority,onChange:s=>n({...t,priority:s.target.value}),className:m,children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:x,children:"Link to Project (optional)"}),e.jsxs("select",{value:t.project_id,onChange:s=>n({...t,project_id:s.target.value}),className:m,children:[e.jsx("option",{value:"",children:"None (General)"}),E.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{onClick:()=>d(!1),className:"flex-1 py-2.5 rounded-lg bg-slate-700 text-foreground hover:bg-slate-600 text-sm font-medium",children:"Cancel"}),e.jsx("button",{onClick:$,disabled:!t.title.trim(),className:"flex-1 py-2.5 rounded-lg bg-primary hover:bg-primary/90 text-primary-foreground text-sm font-bold disabled:opacity-50",children:"Add Note"})]})]})]})})]})};export{we as default};
